<?xml version="1.0" encoding="UTF-8"?>
 
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="TSS240">
 
	<!-- 제품코드명 콤보 조회 -->
	<select id="Get_TSS240_CDList_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
		SELECT  PRDCT_CD   AS CODE  
			  , PRDCT_CDNM AS CODE_NM 
		  FROM  TBL_PRDCT_CD 
		 WHERE  TECH_SVC_YN = 'Y' 
 	</select>
 	    
 	<!-- 품질불만유형코드 조회 -->
	<select id="Get_TSS240_List5_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">    	 	        
	 SELECT DSFT_TYP_CD 
	 	   ,DSFT_TYP_CDNM
	   FROM TBL_DSFT_TYP_CD
	</select>
 	
	<!-- 품질불만이상현황 실험실 파트 조회 -->
	<select id="Get_TSS240_List_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
	  SELECT C.DSFT_TYP_CDNM 
	  	   , C.DSFT_TYP_CD
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '01' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS JAN_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '01' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS JAN_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '02' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS FEB_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '02' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS FEB_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '03' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS MAR_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '03' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS MAR_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '04' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS APR_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '04' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS APR_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '05' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS MAY_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '05' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS MAY_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '06' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS JUN_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '06' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS JUN_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '07' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS JUL_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '07' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS JUL_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '08' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS AUG_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '08' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS AUG_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '09' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS SEPT_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '09' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS SEPT_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '10' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS OCT_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '10' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS OCT_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '11' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS NOV_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '11' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS NOV_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '12' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS DEC_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '12' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS DEC_GAS
	  	   , SUM(CASE WHEN B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END )                                     AS ACCU_CUST
	  	   , SUM(CASE WHEN B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) 								    AS ACCU_GAS 
	  	   , 0                                     														  	AS ACCU_CUST_RAT 
	  	   , 0 								     														  	AS ACCU_GAS_RAT 
		  FROM TBL_TST_REQ A
		  	   INNER JOIN (		  	   
            		  	   SELECT C.TST_ACPN_SEQ_NO
            		  	        , C.CLCT_PLCE_DV_CD
            		  	        , D.DSFT_CAUS_CD		  	   
            		  	     FROM TBL_SAMP_CLCT C
                              INNER JOIN TBL_SAMP_BY_OFCR_OPNN D
                                      ON C.TST_ACPN_SEQ_NO  = D.TST_ACPN_SEQ_NO AND C.SAMP_NO = D.SAMP_NO
                              INNER JOIN (
                                          SELECT A.TST_ACPN_SEQ_NO
                                               , MAX(CASE WHEN (A.CLCT_PLCE_DV_CD = 'HB' AND B.RPS_SAMP_YN = 'Y') THEN 1 ELSE 0 END) AS HB_RPS
                                            FROM  TBL_SAMP_CLCT A
                                                  INNER JOIN TBL_SAMP_BY_OFCR_OPNN B
                                                         ON A.TST_ACPN_SEQ_NO = B.TST_ACPN_SEQ_NO
                                                           AND A.SAMP_NO = B.SAMP_NO        
                                          GROUP BY A.TST_ACPN_SEQ_NO
                                         ) E
                                      ON C.TST_ACPN_SEQ_NO = E.TST_ACPN_SEQ_NO
            		  	    WHERE 1 = (CASE WHEN E.HB_RPS = 0 THEN CASE WHEN (C.CLCT_PLCE_DV_CD = 'HA' AND D.RPS_SAMP_YN = 'Y') THEN 1 ELSE 0 END
                                        ELSE CASE WHEN (C.CLCT_PLCE_DV_CD = 'HB' AND D.RPS_SAMP_YN = 'Y') THEN 1 ELSE 0 END
                                        END)
		 				<dynamic>
			                 <isNotEmpty prepend="AND" property="prdct_cd">
			                          C.PRDCT_CD = #prdct_cd#
			                 </isNotEmpty>
			            </dynamic>
                           ) B 
                ON A.TST_ACPN_SEQ_NO  = B.TST_ACPN_SEQ_NO
		       INNER JOIN TBL_DSFT_TYP_CD C
		        ON A.DSFT_TYP_CD = C.DSFT_TYP_CD
		       WHERE A.TST_REQ_DT BETWEEN #tst_req_dt# || '0000' AND #tst_req_dt# || '1231'
		         AND A.PRGR_ST_CD = '08'
		         AND (A.DEL_YN = 'N' OR A.DEL_YN IS NULL)
		         AND B.DSFT_CAUS_CD != '00'
		     GROUP BY C.DSFT_TYP_CDNM, C.DSFT_TYP_CD 
		     ORDER BY C.DSFT_TYP_CD ASC
    </select>
 	
	<!-- 품질불만이상현황 KIXX 파트 조회 -->
	<select id="Get_TSS240_List2_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
	  SELECT B.DSFT_TYP_CDNM
	  		,B.DSFT_TYP_CD 
		      ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '01' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS JAN_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '01' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS JAN_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '02' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS FEB_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '02' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS FEB_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '03' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS MAR_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '03' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS MAR_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '04' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS APR_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '04' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS APR_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '05' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS MAY_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '05' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS MAY_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '06' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS JUN_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '06' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS JUN_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '07' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS JUL_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '07' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS JUL_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '08' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS AUG_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '08' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS AUG_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '09' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS SEPT_CUST    
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '09' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS SEPT_GAS  
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '10' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS OCT_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '10' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS OCT_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '11' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS NOV_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '11' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS NOV_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '12' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS DEC_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '12' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS DEC_GAS   
			  ,SUM(CASE WHEN ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) 								   AS ACCU_CUST
			  ,SUM(CASE WHEN A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) 								   AS ACCU_GAS
			  ,0 								   																		   AS ACCU_CUST_RAT
			  ,0 								   																	       AS ACCU_GAS_RAT
		  FROM TBL_DSFT_ACPN_PROC A
		   INNER JOIN TBL_DSFT_TYP_CD B
		        ON A.VHCL_BIZTR_QLIT_DSFT_TYP_CD = B.DSFT_TYP_CD
		 WHERE A.ACPN_DTM BETWEEN #tst_req_dt# || '0000000000' AND #tst_req_dt# || '1231240000'
		   AND A.VHCL_BIZTR_YN = 'Y'
       	   AND (A.DSFT_TYP_CD = 'CA' OR A.DSFT_TYP_CD = 'CK')
		   AND (A.DEL_YN = 'N' OR A.DEL_YN IS NULL)
	 	   AND A.PROC_DTM IS NOT NULL
	 	   AND (A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' 
	 	   		OR ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL)
	 	   			 AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00')
	 	   		)
		 <dynamic>
			   <isNotEmpty prepend="AND" property="prdct_cd">
			     A.PRDCT_CD = #prdct_cd#
			   </isNotEmpty>
         </dynamic>	  
        GROUP BY B.DSFT_TYP_CDNM, B.DSFT_TYP_CD
        ORDER BY B.DSFT_TYP_CD ASC
 	</select>
 	
 	<!-- 품질불만이상현황 합계 조회 -->
	<select id="Get_TSS240_List3_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
	 SELECT 
	        Q.DSFT_TYP_CDNM
	       ,Q.DSFT_TYP_CD
	        ,SUM(Q.JAN_CUST)  		AS JAN_CUST			
		    ,SUM(Q.JAN_GAS)  	    AS JAN_GAS 			
		    ,SUM(Q.FEB_CUST)  		AS FEB_CUST			
			,SUM(Q.FEB_GAS)  	    AS FEB_GAS 		  
			,SUM(Q.MAR_CUST) 	    AS MAR_CUST      
			,SUM(Q.MAR_GAS)  	    AS MAR_GAS	      
			,SUM(Q.APR_CUST)  		AS APR_CUST      
			,SUM(Q.APR_GAS)  	    AS APR_GAS	      
			,SUM(Q.MAY_CUST)  		AS MAY_CUST      
			,SUM(Q.MAY_GAS)  	    AS MAY_GAS	      
		 	,SUM(Q.JUN_CUST)  		AS JUN_CUST      
			,SUM(Q.JUN_GAS)         AS JUN_GAS	      
			,SUM(Q.JUL_CUST)      	AS JUL_CUST      
			,SUM(Q.JUL_GAS)       	AS JUL_GAS	      
			,SUM(Q.AUG_CUST)      	AS AUG_CUST      
			,SUM(Q.AUG_GAS)       	AS AUG_GAS	      
			,SUM(Q.SEPT_CUST)     	AS SEPT_CUST     
			,SUM(Q.SEPT_GAS)      	AS SEPT_GAS      
			,SUM(Q.OCT_CUST)      	AS OCT_CUST      
			,SUM(Q.OCT_GAS)       	AS OCT_GAS	      
			,SUM(Q.NOV_CUST)      	AS NOV_CUST      
		    ,SUM(Q.NOV_GAS)       	AS NOV_GAS	      
			,SUM(Q.DEC_CUST)      	AS DEC_CUST      
			,SUM(Q.DEC_GAS)       	AS DEC_GAS	      
			,SUM(Q.ACCU_CUST)     	AS ACCU_CUST     
			,SUM(Q.ACCU_GAS)  	  	AS ACCU_GAS      
			,SUM(Q.ACCU_CUST_RAT) 	AS ACCU_CUST_RAT 
			,SUM(Q.ACCU_GAS_RAT)  	AS ACCU_GAS_RAT  
	   FROM(
	  SELECT C.DSFT_TYP_CDNM 
	  	   , C.DSFT_TYP_CD
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '01' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS JAN_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '01' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS JAN_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '02' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS FEB_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '02' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS FEB_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '03' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS MAR_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '03' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS MAR_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '04' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS APR_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '04' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS APR_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '05' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS MAY_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '05' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS MAY_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '06' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS JUN_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '06' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS JUN_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '07' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS JUL_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '07' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS JUL_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '08' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS AUG_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '08' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS AUG_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '09' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS SEPT_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '09' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS SEPT_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '10' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS OCT_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '10' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS OCT_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '11' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS NOV_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '11' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS NOV_GAS
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '12' AND B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END ) AS DEC_CUST
	  	   , SUM(CASE WHEN SUBSTR(A.TST_REQ_DT,5,2) = '12' AND B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) AS DEC_GAS
	  	   , SUM(CASE WHEN B.CLCT_PLCE_DV_CD = 'HA' THEN 1 ELSE 0 END )                                     AS ACCU_CUST
	  	   , SUM(CASE WHEN B.CLCT_PLCE_DV_CD = 'HB' THEN 1 ELSE 0 END ) 								    AS ACCU_GAS 
	  	   , 0                                     														  	AS ACCU_CUST_RAT 
	  	   , 0 								     														  	AS ACCU_GAS_RAT 
		  FROM TBL_TST_REQ A
		  	   INNER JOIN (		  	   
            		  	   SELECT C.TST_ACPN_SEQ_NO
            		  	        , C.CLCT_PLCE_DV_CD
            		  	        , D.DSFT_CAUS_CD		  	   
            		  	     FROM TBL_SAMP_CLCT C
                              INNER JOIN TBL_SAMP_BY_OFCR_OPNN D
                                      ON C.TST_ACPN_SEQ_NO  = D.TST_ACPN_SEQ_NO AND C.SAMP_NO = D.SAMP_NO
                              INNER JOIN (
                                          SELECT A.TST_ACPN_SEQ_NO
                                               , MAX(CASE WHEN (A.CLCT_PLCE_DV_CD = 'HB' AND B.RPS_SAMP_YN = 'Y') THEN 1 ELSE 0 END) AS HB_RPS
                                            FROM  TBL_SAMP_CLCT A
                                                  INNER JOIN TBL_SAMP_BY_OFCR_OPNN B
                                                         ON A.TST_ACPN_SEQ_NO = B.TST_ACPN_SEQ_NO
                                                           AND A.SAMP_NO = B.SAMP_NO        
                                          GROUP BY A.TST_ACPN_SEQ_NO
                                         ) E
                                      ON C.TST_ACPN_SEQ_NO = E.TST_ACPN_SEQ_NO
            		  	    WHERE 1 = (CASE WHEN E.HB_RPS = 0 THEN CASE WHEN (C.CLCT_PLCE_DV_CD = 'HA' AND D.RPS_SAMP_YN = 'Y') THEN 1 ELSE 0 END
                                        ELSE CASE WHEN (C.CLCT_PLCE_DV_CD = 'HB' AND D.RPS_SAMP_YN = 'Y') THEN 1 ELSE 0 END
                                        END)
		 				<dynamic>
			                 <isNotEmpty prepend="AND" property="prdct_cd">
			                          C.PRDCT_CD = #prdct_cd#
			                 </isNotEmpty>
			            </dynamic>
                           ) B 
                ON A.TST_ACPN_SEQ_NO  = B.TST_ACPN_SEQ_NO
		       INNER JOIN TBL_DSFT_TYP_CD C
		        ON A.DSFT_TYP_CD = C.DSFT_TYP_CD
		       WHERE A.TST_REQ_DT BETWEEN #tst_req_dt# || '0000' AND #tst_req_dt# || '1231'
		         AND A.PRGR_ST_CD = '08'
		         AND (A.DEL_YN = 'N' OR A.DEL_YN IS NULL)
		         AND B.DSFT_CAUS_CD != '00'
		     GROUP BY C.DSFT_TYP_CDNM, C.DSFT_TYP_CD 
		     
	 UNION ALL
	
	  SELECT B.DSFT_TYP_CDNM
	  		,B.DSFT_TYP_CD 
		      ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '01' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS JAN_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '01' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS JAN_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '02' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS FEB_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '02' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS FEB_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '03' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS MAR_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '03' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS MAR_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '04' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS APR_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '04' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS APR_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '05' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS MAY_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '05' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS MAY_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '06' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS JUN_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '06' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS JUN_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '07' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS JUL_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '07' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS JUL_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '08' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS AUG_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '08' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS AUG_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '09' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS SEPT_CUST    
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '09' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS SEPT_GAS  
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '10' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS OCT_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '10' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS OCT_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '11' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS NOV_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '11' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS NOV_GAS   
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '12' AND ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) AS DEC_CUST     
			  ,SUM(CASE WHEN SUBSTR(A.ACPN_DTM,5,2) = '12' AND A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) AS DEC_GAS   
			  ,SUM(CASE WHEN ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL) AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00') THEN 1 ELSE 0 END ) 								   AS ACCU_CUST
			  ,SUM(CASE WHEN A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' THEN 1 ELSE 0 END ) 								   AS ACCU_GAS
			  ,0 								   																		   AS ACCU_CUST_RAT
			  ,0 								   																	       AS ACCU_GAS_RAT
		  FROM TBL_DSFT_ACPN_PROC A
		   INNER JOIN TBL_DSFT_TYP_CD B
		        ON A.VHCL_BIZTR_QLIT_DSFT_TYP_CD = B.DSFT_TYP_CD
		 WHERE A.ACPN_DTM BETWEEN #tst_req_dt# || '0000000000' AND #tst_req_dt# || '1231240000'
		   AND A.VHCL_BIZTR_YN = 'Y'
       	   AND (A.DSFT_TYP_CD = 'CA' OR A.DSFT_TYP_CD = 'CK')
		   AND (A.DEL_YN = 'N' OR A.DEL_YN IS NULL)
	 	   AND A.PROC_DTM IS NOT NULL
	 	   AND (A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST != '00' 
	 	   		OR ((A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = '' OR A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST IS NULL)
	 	   			 AND A.VHCL_QLIT_DSFT_CAUS_CD_CUST != '00')
	 	   		)
		 <dynamic>
			   <isNotEmpty prepend="AND" property="prdct_cd">
			     A.PRDCT_CD = #prdct_cd#
			   </isNotEmpty>
         </dynamic>	  
        GROUP BY B.DSFT_TYP_CDNM, B.DSFT_TYP_CD
      )Q  
      GROUP BY Q.DSFT_TYP_CDNM, Q.DSFT_TYP_CD        
      ORDER BY Q.DSFT_TYP_CD ASC
    </select> 	

    <!-- 품질불만이상현황 상세 조회 -->
	<select id="Get_TSS240_List4_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
    SELECT A.TST_ACPN_SEQ_NO   
         , A.CUST_ID            
         , A.CUST_NM          
         , A.CUST_ZIP_NO     
         , A.CUST_ADDR1         
         , A.CUST_ADDR2         
         , A.CUST_ADDR3       
         , A.CUST_ADDR4         
         , A.CUST_TEL_NO        
         , A.DSFT_ACPN_SEQ_NO  
         , A.DSFT_ENTR_ID       
         , A.DSFT_ENTR_NM       
         , A.PRBLM_ORGN_DT      
         , A.DSFT_TYP_CD        
         , D.DSFT_TYP_CDNM       
         , A.TST_REQ_DT         
         , A.CHRG_MC_ID        
         , A.CHRG_MC_NM        
         , A.CHRG_TEAM_CD    
         , A.TEAM_NM           
         , A.SAMP_CUNT          
         , A.TSTRM_CD            
         , (SELECT E.TSTRM_CDNM
         	  FROM TBL_TSTRM_CD E
         	 WHERE A.TSTRM_CD = E.TSTRM_CD
           ) AS TSTRM_CDNM	  
         , A.TST_OFCR_ID      
         , A.TST_OFCR_NM    
         , A.SCHE_CLCT_DT  
         , A.DTLS_DSFT_MTTR  
         , A.PRGR_ST_CD       
         , C.PRGR_ST_CDNM    
         , C.BFTH_PGM_ID       
         , C.NEXT_PGM_ID      
         , A.CNVY_METH_CD     
         , A.ACPR_ID          
         , A.ACPR_NM          
         , A.ACPN_DTM   
         , A.TRMS_NCNT     
         , B.PRDCT_CD1         
         , B.PRDCT_CD2        
         , B.PRDCT_DTLS_CD1  
         , B.PRDCT_DTLS_CD2
		 , FUN_GET_PRDCT_DTL_CDNM(B.PRDCT_DTLS_CD1) AS PRDCT_DTLS_CDNM1  <!--  제품 상세코드명(고객)   -->
		 , FUN_GET_PRDCT_DTL_CDNM(B.PRDCT_DTLS_CD2) AS PRDCT_DTLS_CDNM2  <!--  제품 상세코드명(주유소) -->
         , B.DSFT_CAUS_CD1       
         , B.DSFT_CAUS_CD2      
         , B.DSFT_CAUS_CDNM1      
         , B.DSFT_CAUS_CDNM2    
      FROM TBL_TST_REQ A
           INNER JOIN 
				(SELECT A.TST_ACPN_SEQ_NO 
				      , MAX(CASE WHEN B.CLCT_PLCE_DV_CD = 'HA' THEN B.PRDT_CD END) AS PRDCT_CD1
				      , MAX(CASE WHEN B.CLCT_PLCE_DV_CD = 'HB' THEN B.PRDT_CD END) AS PRDCT_CD2
				      , MAX(CASE WHEN B.CLCT_PLCE_DV_CD = 'HA' THEN B.PRDT_DTLS_CD END) AS PRDCT_DTLS_CD1
				      , MAX(CASE WHEN B.CLCT_PLCE_DV_CD = 'HB' THEN B.PRDT_DTLS_CD END) AS PRDCT_DTLS_CD2      
				      , MAX(CASE WHEN B.CLCT_PLCE_DV_CD = 'HA' THEN B.DSFT_CAUSE_CD END) AS DSFT_CAUS_CD1
				      , MAX(CASE WHEN B.CLCT_PLCE_DV_CD = 'HB' THEN B.DSFT_CAUSE_CD END) AS DSFT_CAUS_CD2 
				      , MAX(CASE WHEN B.CLCT_PLCE_DV_CD = 'HA' THEN FUN_GET_DSFT_CAUS_CDNM(B.DSFT_CAUSE_CD)
				      			 ELSE NULL END) AS DSFT_CAUS_CDNM1
				      , MAX(CASE WHEN B.CLCT_PLCE_DV_CD = 'HB' THEN FUN_GET_DSFT_CAUS_CDNM(B.DSFT_CAUSE_CD)
				      			 ELSE NULL END) AS DSFT_CAUS_CDNM2
				   FROM TBL_SAMP_CLCT A
				        INNER JOIN
				        	 (SELECT A.TST_ACPN_SEQ_NO
				                   , A.CLCT_PLCE_DV_CD
				                   , CASE WHEN B.RPS_SAMP_YN = 'Y' THEN A.PRDCT_CD 
				                          WHEN B.RPS_SAMP_YN IS NULL 
				                           AND (ROW_NUMBER() OVER (PARTITION BY A.TST_ACPN_SEQ_NO,A.CLCT_PLCE_DV_CD ORDER BY TO_NUMBER(SUBSTR(A.SAMP_NO,5,4)))) = 1 THEN A.PRDCT_CD
				                     END PRDT_CD
				                   , CASE WHEN B.RPS_SAMP_YN = 'Y' THEN A.PRDCT_DTLS_CD 
				                          WHEN B.RPS_SAMP_YN IS NULL 
				                           AND (ROW_NUMBER() OVER (PARTITION BY A.TST_ACPN_SEQ_NO,A.CLCT_PLCE_DV_CD ORDER BY TO_NUMBER(SUBSTR(A.SAMP_NO,5,4)))) = 1 THEN A.PRDCT_DTLS_CD
				                     END PRDT_DTLS_CD
				                   , CASE WHEN B.RPS_SAMP_YN = 'Y' THEN B.DSFT_CAUS_CD
				                          WHEN B.RPS_SAMP_YN IS NULL 
				                           AND (ROW_NUMBER() OVER (PARTITION BY A.TST_ACPN_SEQ_NO,A.CLCT_PLCE_DV_CD ORDER BY TO_NUMBER(SUBSTR(A.SAMP_NO,5,4)))) = 1 THEN B.DSFT_CAUS_CD
				                     END DSFT_CAUSE_CD
				                   , ROW_NUMBER() OVER (PARTITION BY A.TST_ACPN_SEQ_NO,A.CLCT_PLCE_DV_CD ORDER BY B.RPS_SAMP_YN) AS RNK
				                FROM TBL_SAMP_CLCT A
				                     LEFT JOIN TBL_SAMP_BY_OFCR_OPNN B
				                            ON A.TST_ACPN_SEQ_NO = B.TST_ACPN_SEQ_NO
				                           AND A.SAMP_NO = B.SAMP_NO
                       		   WHERE B.RPS_SAMP_YN = 'Y'
		                       <dynamic>
			                       <isNotEmpty prepend="AND" property="prdct_cd">
			                         A.PRDCT_CD = #prdct_cd#
						           </isNotEmpty>
		                       </dynamic>
				       		) B
				       	    ON A.TST_ACPN_SEQ_NO = B.TST_ACPN_SEQ_NO
				           AND B.RNK = 1
				  GROUP BY A.TST_ACPN_SEQ_NO
				) B
                ON A.TST_ACPN_SEQ_NO = B.TST_ACPN_SEQ_NO
	         INNER JOIN TBL_PRGR_ST_CD C           
	                 ON A.PRGR_ST_CD = C.PRGR_ST_CD
	         INNER JOIN TBL_DSFT_TYP_CD D           
	                 ON A.DSFT_TYP_CD = D.DSFT_TYP_CD
        WHERE A.TST_REQ_DT BETWEEN #tst_req_dt# || '01' AND #tst_req_dt# || '31'
          AND (A.DEL_YN = 'N' OR A.DEL_YN IS NULL)
          AND D.DSFT_TYP_CD = #dsft_typ_cd#
          AND (B.DSFT_CAUS_CD2 != '00' OR (B.DSFT_CAUS_CD2 IS NULL AND B.DSFT_CAUS_CD1 != '00'))
     ORDER BY A.ACPN_DTM DESC
    </select>
 	
</sqlMap>
