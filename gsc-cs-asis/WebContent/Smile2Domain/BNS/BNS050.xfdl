<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.2">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="BNS050" classname="BNS340" inheritanceid="" cachelevel="" position="absolute 0 0 178 180" version="" titletext="New Form">
    <Layout>
      <Grid id="Grd_CustSmry" taborder="0" binddataset="ds_cust_smry" position="absolute 0 0 178 180" style="border:1 solid #ffffffff ;" tooltiptype="hover" oncellclick="Grd_CustSmry_oncellclick">
        <Formats>
          <Format id="default">
            <Columns>
              <Column size="0"/>
              <Column size="176"/>
            </Columns>
            <Rows>
              <Row size="20"/>
            </Rows>
            <Band id="body" style="background:#ffffffff;selectborder:0 solid #ffffffff ;selectbackground:#f7ebdaff;selectfont:dotum,8,bold;selectcolor:#eb7731ff;cellline:1 solid #ffffffff ;cellcolor:#3f6585ff;">
              <Cell text="bind:ITEM"/>
              <Cell col="1" style="align:left;color:#5f778eff;color2:#5f778eff;font:Dotum,9;selectcolor:#5f778eff;selectfont:Dotum,9,bold;" class="sta_WFSA_labelP" text="bind:ITEM_RSLT"/>
            </Band>
          </Format>
        </Formats>
      </Grid>
    </Layout>
    <Objects>
      <Dataset id="ds_cust_smry" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="ITEM" type="STRING" size="256"/>
          <Column id="ITEM_RSLT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cust_tdnc" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="TDNC_DV_CD" type="STRING" size="256"/>
          <Column id="TDNC_DV_CD_NM" type="STRING" size="256"/>
          <Column id="CTT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cust_dsft" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="PROC_Y_CNT" type="STRING" size="256"/>
          <Column id="PROC_N_CNT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_srch_db" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_recnt_cntc_phn" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="RECNT_NO" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_tdy_cntc_phn" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="TODAY_NO" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_inline_no" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="INLINE_NO" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_copy_srch_upd_hist" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_srch_inbnd_cmp" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CMP_ID" type="STRING" size="256"/>
          <Column id="QUST_SEQ_NO" type="STRING" size="256"/>
          <Column id="STR_DT" type="STRING" size="256"/>
          <Column id="END_DT" type="STRING" size="256"/>
          <Column id="GOAL_NCNT" type="STRING" size="256"/>
          <Column id="GOAL_ACVMT_NCNT" type="STRING" size="256"/>
          <Column id="ASGN_TRCN_PINT_GTEQ" type="STRING" size="256"/>
          <Column id="ASGN_TRCN_PINT_LTEQ" type="STRING" size="256"/>
          <Column id="ASGN_TRCN_AGE_GTEQ" type="STRING" size="256"/>
          <Column id="ASGN_TRCN_AGE_LTEQ" type="STRING" size="256"/>
          <Column id="ASGN_TRCN_MAN_YN" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_blk_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="ANI_NO1" type="STRING" size="256"/>
          <Column id="ANI_NO2" type="STRING" size="256"/>
          <Column id="ANI_NO3" type="STRING" size="256"/>
          <Column id="ANI_NO4" type="STRING" size="256"/>
          <Column id="ANI_NO5" type="STRING" size="256"/>
          <Column id="CUST_NO" type="STRING" size="256"/>
          <Column id="BL_CD" type="STRING" size="256"/>
          <Column id="CTT" type="STRING" size="256"/>
          <Column id="REG_ID" type="STRING" size="256"/>
          <Column id="REG_DTM" type="STRING" size="256"/>
          <Column id="LST_CORC_ID" type="STRING" size="256"/>
          <Column id="LST_CORC_DTM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/********************************************************************************** 
 *****	SUMMARY (height:160, width:178)
***********************************************************************************/

include "LIB::CommonLib.xjs"

var gUsrId =  getTrim(GetUserInfo("gUSR_ID"));

function fn_srchFormData()
{
	traceX("fn_srchFormData Call");
	var objCustDs 		= this.parent.parent.all["ds_cust_info"];
	var objSrchUpdDs 	= this.parent.parent.all["ds_cust_srch_upd_hist"];
	var objFlgDs  		= this.parent.parent.all["ds_srch_flg"];	

	if(objCustDs.getColumn(0,"IO_CUST_NO") == ""){
		objCustDs.setColumn(0,"PCON_CUST_GRD_NM","");
		return;
	}
	// 고객등급세팅
	this.parent.parent.fn_setCustCls();
	// 고객정보조회변경이력 DS 세팅	
	this.parent.parent.fn_setCustSrchUpdHistDs("S");			
	ds_copy_srch_upd_hist.copyData(objSrchUpdDs);	
	
	fn_clearFormData();
	ds_srch_db.clearData();
	fun_ds_srch(ds_srch_db, "CUST_ID",objCustDs.getColumn(0,"IO_CUST_NO"));
	fun_ds_srch(ds_srch_db, "ANI_NO",ds_inline_no.getColumn(0,"INLINE_NO"));
		
	var	strSvcID = "R1";
	var	strURL = SVC_USR_URL;
	var	strInDatasets = "SELECT_0_IDATA=ds_srch_db:a";
		strInDatasets = strInDatasets + " SELECT_1_IDATA=ds_srch_db:a";
		strInDatasets = strInDatasets + " SELECT_2_IDATA=ds_srch_db:a";
		strInDatasets = strInDatasets + " SELECT_3_IDATA=ds_srch_db:a";	
		//strInDatasets = strInDatasets + " INSERT_4_IDATA=ds_copy_srch_upd_hist:a"; //20151112 GSC 요청으로 고객정보저장 막음
		strInDatasets = strInDatasets + " SELECT_5_IDATA=ds_srch_db:a";		
		strInDatasets = strInDatasets + " SELECT_6_IDATA=ds_srch_db:a";		
 
	var	strOutDatasets = "ds_cust_tdnc=SELECT_0_ODATA";
		strOutDatasets = strOutDatasets + " ds_cust_dsft=SELECT_1_ODATA";
		strOutDatasets = strOutDatasets + " ds_recnt_cntc_phn=SELECT_2_ODATA";
		strOutDatasets = strOutDatasets + " ds_tdy_cntc_phn=SELECT_3_ODATA";
		strOutDatasets = strOutDatasets + " ds_srch_inbnd_cmp=SELECT_5_ODATA";
		strOutDatasets = strOutDatasets + " ds_blk_info=SELECT_6_ODATA";
	 
	var	strArgument = "SELECT_0_ID=BNS050.Get_CustTdnc_SELECT";
		strArgument	= strArgument + " SELECT_1_ID=BNS050.Get_CustDsft_SELECT";
		strArgument	= strArgument + " SELECT_2_ID=BNS050.Get_RecntCntcPhn_SELECT";
		strArgument	= strArgument + " SELECT_3_ID=BNS050.Get_TdyCntcPhn_SELECT";
		//strArgument = strArgument + " INSERT_4_ID=BNS010.Set_SrchUpdHist_INSERT"; //20151112 GSC 요청으로 고객정보저장 막음
		strArgument	= strArgument + " SELECT_5_ID=BNS050.Get_InbndQust_SELECT";	
		strArgument	= strArgument + " SELECT_6_ID=ARS010.get_BL_CD_SELECT";	
									
	var strCallbackFunc = "fn_callBack";
	
	if(getTrim(objFlgDs.getColumn(0,"CALL_IN_YN")) == "Y"){
		var strProcessBar = false;
	}else{
		var strProcessBar = true;		
	}
	
	cf_SVC(strSvcID,strURL,strInDatasets,strOutDatasets,strArgument,strCallbackFunc,strProcessBar);
		
	return;	
}

// 가맹점조회 Summary 
function fn_srchFormDataFrch()
{
	var objCustDs 		= this.parent.parent.all["ds_cust_info"];	
	var objFlgDs  		= this.parent.parent.all["ds_srch_flg"];
		
	fn_clearFormData();
	ds_srch_db.clearData();
	fun_ds_srch(ds_srch_db, "CUST_ID",objCustDs.getColumn(0,"IO_CUST_NO"));
	fun_ds_srch(ds_srch_db, "ANI_NO",ds_inline_no.getColumn(0,"INLINE_NO"));
	
	var	strSvcID = "R2";
	var	strURL = SVC_USR_URL;
	var	strInDatasets = "SELECT_0_IDATA=ds_srch_db:a";
		strInDatasets = strInDatasets + " SELECT_1_IDATA=ds_srch_db:a";
		strInDatasets = strInDatasets + " SELECT_2_IDATA=ds_srch_db:a";
		strInDatasets = strInDatasets + " SELECT_3_IDATA=ds_srch_db:a";		
 
	var	strOutDatasets = "ds_cust_tdnc=SELECT_0_ODATA";
		strOutDatasets = strOutDatasets + " ds_recnt_cntc_phn=SELECT_1_ODATA";
		strOutDatasets = strOutDatasets + " ds_tdy_cntc_phn=SELECT_2_ODATA";
		strOutDatasets = strOutDatasets + " ds_blk_info=SELECT_3_ODATA";
	 
	var	strArgument = "SELECT_0_ID=BNS050.Get_CustTdnc_SELECT";
		strArgument	= strArgument + " SELECT_1_ID=BNS050.Get_RecntCntcPhn_SELECT";
		strArgument	= strArgument + " SELECT_2_ID=BNS050.Get_TdyCntcPhn_SELECT";
		strArgument	= strArgument + " SELECT_3_ID=ARS010.get_BL_CD_SELECT";	
									
	var strCallbackFunc = "fn_callBack";
	
	if(getTrim(objFlgDs.getColumn(0,"CALL_IN_YN")) == "Y"){
		var strProcessBar = false;
	}else{
		var strProcessBar = true;		
	}
	
	cf_SVC(strSvcID,strURL,strInDatasets,strOutDatasets,strArgument,strCallbackFunc,strProcessBar);
		
	return;		
}

// 콜백처리
function fn_callBack(svcid,strErrCode,strErrMsg)
{	
	var objFlgDs  		= this.parent.parent.all["ds_srch_flg"];
	var objCustDs 		= this.parent.parent.all["ds_cust_info"];
		
	// 개인, 사업자
	if(svcid == "R1"){
		// 인바운드콜인 경우 인바운드 캠페인 조건비교
		if(		getTrim(objCustDs.getColumn(0,"OT_CUST_DIV_CD")) == "01"
			&&	getTrim(objFlgDs.getColumn(0,"CALL_IN_YN")) == "Y" 
			&& 	getTrim(objFlgDs.getColumn(0,"FLAG")) == "0"
			&& 	getTrim(objFlgDs.getColumn(0,"FRCH_YN")) == "N"){
			fn_chkQustCond();
		}
		fn_setSummary(svcid);		
	}
	
	// 가맹점
	if(svcid == "R2"){
		fn_setSummary(svcid);
	}
	
	// 악성고객 조회
	if(svcid == "R3"){
		fn_setSummary(svcid);
	}	
}

// 조회된 정보로 Summary정보를 세팅한다.
function fn_setSummary(strSvcId)
{
	// 상담생성 후 조회한 고객리스트의 고객성향 세팅(접촉저장에서 조회고객 선택시 고객성향을 변경하기 위함)
	var objCnslDs = this.parent.parent.all["Tab_CntctHistInfo"]["tabpage1"].all["ds_cnsl_seq_out"];	// 상담일련번호 DS
	var objFlgDs  = this.parent.parent.all["ds_srch_flg"];
	var objSrchedCustDs = this.parent.parent.all["ds_srched_cust"];				// 상담생성 중 조회된 고객리스트	
	var strTdnc   = "";
    if(ds_cust_tdnc.rowcount > 0){
		strTdnc = ds_cust_tdnc.getColumn(ds_cust_tdnc.rowposition,"CTT");
    }
    
//	if(objCnslDs.rowcount > 0){
		cf_trace("BNS050 성향세팅(조회고객수) : ",objSrchedCustDs.rowcount);	
		if(objSrchedCustDs.rowcount > 0 && objFlgDs.getColumn(0,"FLAG") == "0"){			// OB LIST 조회가 아닌 경우 조회고객 리스트에 추가	
			var objCustDs 	= this.parent.parent.all["ds_cust_info"];						// 상담화면 조회된 고객
			var intRow		= objSrchedCustDs.findRow("CUST_NO",objCustDs.getColumn(0,"IO_CUST_NO"));					
			objSrchedCustDs.setColumn(intRow,"CUST_TDNC",strTdnc);
			objSrchedCustDs.setColumn(intRow,"CUST_TDNC_DIV",ds_cust_tdnc.getColumn(ds_cust_tdnc.rowposition,"TDNC_DV_CD"));			
		}
//	}
	
	if(strSvcId == "R1"){
		// Summary정보 세팅
		var strDsftProcY	= "불만처리 : " + ds_cust_dsft.getColumn(ds_cust_dsft.rowposition,"PROC_Y_CNT");
		var strDsftProcN	= "불만미처리 : " + ds_cust_dsft.getColumn(ds_cust_dsft.rowposition,"PROC_N_CNT");
	}

	if(ds_cust_tdnc.rowcount < 1){
		var strCustTdncDiv 	= "고객성향 : "; 
	} else{
		var strCustTdncDiv 	= "고객성향 : " + getTrim(ds_cust_tdnc.getColumn(ds_cust_tdnc.rowposition,"TDNC_DV_CD_NM"));
	}		
	
	if(ds_cust_tdnc.rowcount < 1){
		var strCustTdnc 	= "성향상세 : "; 
	} else{
		var strCustTdnc 	= "성향상세 : " + getTrim(ds_cust_tdnc.getColumn(ds_cust_tdnc.rowposition,"CTT"));
	}
	
	if(ds_inline_no.rowcount < 1){
		var strInLineNo		= "현재통화 : ";
	} else{
		var strInLineNo		= "현재통화 : " + maskPhone(getTrim(ds_inline_no.getColumn(0,"INLINE_NO"))) + fn_getCompNo(getTrim(ds_inline_no.getColumn(0,"INLINE_NO")));	
	}

	if(ds_recnt_cntc_phn.rowcount < 1){
		var strRecntCntcPhn = "최근통화 :  "; 	
	}else{
		var strRecntCntcPhn = "최근통화 : " + maskPhone(ds_recnt_cntc_phn.getColumn(0,"RECNT_NO")) + fn_getCompNo(ds_recnt_cntc_phn.getColumn(0,"RECNT_NO")); 	
	}
	
	if(ds_tdy_cntc_phn.rowcount < 1){
		var strTdyCntcPhn 	= "금일통화 :  "; 	
	}else{
		var strTdyCntcPhn	= "금일통화 : " + maskPhone(ds_tdy_cntc_phn.getColumn(0,"TODAY_NO")) + fn_getCompNo(ds_tdy_cntc_phn.getColumn(0,"TODAY_NO"));
	}	

//	strCustTdnc 	= fn_getDownLenStr(strCustTdnc);
/*	
	strRecntCntcPhn = fn_getDownLenStr(strRecntCntcPhn);
	strTdyCntcPhn 	= fn_getDownLenStr(strTdyCntcPhn);	
*/

	if(ds_blk_info.rowcount < 1){
		var strBlkInfo 	= "악성고객 :  "; 	
	}else{
		var tmpBlInfo = getTrim(ds_blk_info.getColumn(ds_blk_info.rowposition,"BL_CD"));
		
		if(tmpBlInfo == "1"){
			var strBlkInfo	= "악성고객 : 악성1차";
		}else if(tmpBlInfo == "2"){
			var strBlkInfo	= "악성고객 : 악성2차";
		}else if(tmpBlInfo == "3"){
			var strBlkInfo	= "악성고객 : 블랙리스트";
		}
		
	}

	//고객성향
	ds_cust_smry.addRow();
	ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM","CUST_TDNC_DIV");	
	ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM_RSLT",strCustTdncDiv);

	//성향상세
	ds_cust_smry.addRow();
	ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM","CUST_TDNC");	
	ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM_RSLT",strCustTdnc);
	
	// 현재통화번호
	ds_cust_smry.addRow();
	ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM","INLINE_NO");	
	ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM_RSLT",strInLineNo);	
	
	//최근통화번호
	ds_cust_smry.addRow();
	ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM","RECNT_NO");
	ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM_RSLT",strRecntCntcPhn);
	
	//금일통화번호
	ds_cust_smry.addRow();
	ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM","TODAY_NO");
	ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM_RSLT",strTdyCntcPhn);		
		
	if(strSvcId == "R1"){
		//불만처리건
		ds_cust_smry.addRow();
		ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM","DSFT_PROC_Y");	
		ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM_RSLT",strDsftProcY);
		
		//불만미처리건
		ds_cust_smry.addRow();
		ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM","DSFT_PROC_N");
		ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM_RSLT",strDsftProcN);
	}
	
	//악성고객정보
	ds_cust_smry.addRow();
	ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM","BLK_INFO");
	ds_cust_smry.setColumn(ds_cust_smry.rowposition,"ITEM_RSLT",strBlkInfo);
	
	ds_cust_smry.rowposition = 0;
	Grd_CustSmry.tooltiptext = ds_cust_smry.getColumn(ds_cust_smry.rowposition,"ITEM_RSLT");	
	
	// 구매이력, 접촉저장세팅 호출(접촉저장에서 조회고객 선택시 고객성향을 변경하기 위함)
	this.parent.parent.fn_setNewCustTabPage();
	
}

function fn_getDownLenStr(strPara)
{
	if(strPara.length > 16){
		return strPara.substr(0,16) + "..."
	}
	
	return strPara;
}

function fn_getCompNo(strPhnNo)
{
	var strPhnKnd = " (미등록번호)";
	var objCustDs = this.parent.parent.all["ds_cust_info"];
	
	if(getTrim(objCustDs.getColumn(0,"IO_CUST_NO")) == ""){
		return strPhnKnd;
	}
		
	if(objCustDs.getColumn(0,"OT_HOME_PHONE_NO").replace("-","") == strPhnNo && strPhnNo != ""){
		strPhnKnd=" (자택)";
		return strPhnKnd;
	}else if(objCustDs.getColumn(0,"OT_OFF_PHONE_NO").replace("-","") == strPhnNo && strPhnNo != ""){
		strPhnKnd=" (직장)";
		return strPhnKnd;	
	}else if(objCustDs.getColumn(0,"OT_HND_PHONE_NO").replace("-","") == strPhnNo && strPhnNo != ""){
		strPhnKnd=" (휴대)";
		return strPhnKnd;	
	}
	
	return strPhnKnd;
}

// 셀클릭 tooltip 내용 변경
function Grd_CustSmry_oncellclick(obj:Grid, e:GridClickEventInfo)
{
/*
	if(e.row == ds_cust_smry.findRow("ITEM","CUST_TDNC")){
		if(ds_cust_tdnc.rowcount < 1){
			obj.tooltiptext = ds_cust_smry.getColumn(e.row,"ITEM_RSLT");
		}else{
			obj.tooltiptext = ds_cust_tdnc.getColumn(ds_cust_tdnc.rowposition,"CTT");
		}
	}else{
		obj.tooltiptext = ds_cust_smry.getColumn(e.row,"ITEM_RSLT");
	}
*/
	obj.tooltiptext = ds_cust_smry.getColumn(e.row,"ITEM_RSLT");
}

// 현재통화 변경(고객 조회 후)
function fn_setInlineNo()
{
	if(ds_inline_no.rowcount < 1){
		var strInLineNo		= "현재통화 : ";
	} else{
		var strInLineNo		= "현재통화 : " + maskPhone(ds_inline_no.getColumn(0,"INLINE_NO")) + fn_getCompNo(ds_inline_no.getColumn(0,"INLINE_NO"));
	}
	
	var introw = ds_cust_smry.findRow("ITEM","INLINE_NO");
		
	ds_cust_smry.setColumn(introw,"ITEM_RSLT",strInLineNo);		
}

function fn_clearFormData()
{
	ds_cust_dsft.clearData();
	ds_cust_tdnc.clearData();
	ds_recnt_cntc_phn.clearData();
	ds_tdy_cntc_phn.clearData();
	ds_cust_smry.clearData();
	ds_srch_inbnd_cmp.clearData();
	ds_blk_info.clearData();
}


// 주민등록번호를 받을 수 없기 때문에 사용안함
// 주민등록번호로 나이계산
function fn_getAge(strJumin)
{	
	if(strJumin.length == 13){
		var strGbn 	= strJumin.substr(6,1);
		var strYear	= getToday().substr(0,4);
		var strAge 	= strJumin.substr(0,2); 
		var intAge  = 0;
		
		if (strGbn == "3" || strGbn == "4" || strGbn == "7" || strGbn == "8" ){
			intAge = parseInt(strYear) - parseInt("20" + strAge) + 1;
		}else{
			intAge = parseInt(strYear) - parseInt("19" + strAge) + 1;			
		}
		
		if(intAge < 0){
			return -1;
		}else{
			return intAge;		
		}
	}else{
		return -1;
	}
}


// 인바운드설문 조건 검사 및 인바운드 설문여부세팅
function fn_chkQustCond()
{
	var objFlgDs  = this.parent.parent.all["ds_srch_flg"];
	var objCustDs = this.parent.parent.all["ds_cust_info"];
	
	var intPoint  = parseInt(getTrim(objCustDs.getColumn(0,"OT_TOT_PT")));
	var intAge 	  = fn_getAge(ds_cust_info.getColumn(0,"OT_HEAD_RS_BZ_NO") + ds_cust_info.getColumn(0,"OT_TAIL_RS_BZ_NO"));
    var strManYn = "";
	if(getTrim(objCustDs.getColumn(0,"OT_SEX_CD")) == "1"){
		strManYn  = "Y";
	}else if(getTrim(objCustDs.getColumn(0,"OT_SEX_CD")) == "2"){
		strManYn  = "N";
	}	    
		
	if(ds_srch_inbnd_cmp.rowcount > 0){
		if(   getTrim(ds_srch_inbnd_cmp.getColumn(0,"ASGN_TRCN_PINT_GTEQ")) != ""			// 포인트
		   && getTrim(ds_srch_inbnd_cmp.getColumn(0,"ASGN_TRCN_PINT_LTEQ")) != ""){
			if(	  intPoint < parseInt(getTrim(ds_srch_inbnd_cmp.getColumn(0,"ASGN_TRCN_PINT_GTEQ")))
		       || intPoint > parseInt(getTrim(ds_srch_inbnd_cmp.getColumn(0,"ASGN_TRCN_PINT_LTEQ")))){

		        ds_srch_flg.setColumn(0,"INBND_CMP_YN","N");
		        return;
		    }
		}		
		if(   getTrim(ds_srch_inbnd_cmp.getColumn(0,"ASGN_TRCN_AGE_GTEQ")) != ""			// 나이
		   && getTrim(ds_srch_inbnd_cmp.getColumn(0,"ASGN_TRCN_AGE_LTEQ")) != ""){
			if(	  intAge < parseInt(getTrim(ds_srch_inbnd_cmp.getColumn(0,"ASGN_TRCN_AGE_GTEQ")))
		       || intAge > parseInt(getTrim(ds_srch_inbnd_cmp.getColumn(0,"ASGN_TRCN_AGE_LTEQ")))){
		        ds_srch_flg.setColumn(0,"INBND_CMP_YN","N");
		        return;
		    }
		}		
		if(getTrim(ds_srch_inbnd_cmp.getColumn(0,"ASGN_TRCN_MAN_YN")) != ""){				// 성별
			if(getTrim(ds_srch_inbnd_cmp.getColumn(0,"ASGN_TRCN_MAN_YN")) != strManYn){
			    ds_srch_flg.setColumn(0,"INBND_CMP_YN","N");
				return;
			}
		}

		// 인바운드 설문세팅
		objFlgDs.setColumn(0,"INBND_CMP_YN","Y");
	}else{
		objFlgDs.setColumn(0,"INBND_CMP_YN","N");
	}
}

//악성고객 등급 조회
function fn_srchFormDataBlk()
{
	
	var objCustDs 		= this.parent.parent.all["ds_cust_info"];
	var objSrchUpdDs 	= this.parent.parent.all["ds_cust_srch_upd_hist"];
	var objFlgDs  		= this.parent.parent.all["ds_srch_flg"];	
	
	fn_clearFormData();
	ds_srch_db.clearData();
	fun_ds_srch(ds_srch_db, "ani_no",ds_inline_no.getColumn(0,"INLINE_NO"));	

	var	strSvcID = "R3";
	var	strURL = SVC_USR_URL;
	var	strInDatasets = "SELECT_0_IDATA=ds_srch_db:a"; 
	var	strOutDatasets = "ds_blk_info=SELECT_0_ODATA";
	var	strArgument = "SELECT_0_ID=ARS010.get_BL_CD_SELECT";
	var strCallbackFunc = "fn_callBack";
	
	if(getTrim(objFlgDs.getColumn(0,"CALL_IN_YN")) == "Y"){
		var strProcessBar = false;
	}else{
		var strProcessBar = true;		
	}
	
	cf_SVC(strSvcID,strURL,strInDatasets,strOutDatasets,strArgument,strCallbackFunc,strProcessBar);
	
}

//traceX 로그(2014.04.14)
function traceX(strLog)
{	
	
	var objDate = new Date();
	var strDate = objDate.toFormatString("%Y-%m-%d", "ko_KR");
	var strFileName = "LOG_" + strDate + ".txt";
	
	var strTime = "[" + objDate.toFormatString("%H:%M:%S") + "." + objDate.getMilliseconds() + "]";
	var vfile = new VirtualFile(strFileName, VirtualFile.openAppend);
	vfile.write(strTime + strLog);
	vfile.close();
	
}]]></Script>
  </Form>
</FDL>
