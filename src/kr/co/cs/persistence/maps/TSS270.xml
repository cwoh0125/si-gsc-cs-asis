<?xml version="1.0" encoding="UTF-8"?>
 
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="TSS270">

 	 <!-- 제품 조회 -->
	<select id="Get_TSS270_List2_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
	SELECT A.PRDCT_CD
	      ,A.PRDCT_CDNM
	      ,B.PRDCT_DTLS_CD
	      ,B.PRDCT_DTLS_CDNM
	  FROM TBL_PRDCT_CD A
	  INNER JOIN TBL_PRDCT_DTLS_CD B
	     ON A.PRDCT_CD = B.PRDCT_CD		 		  
 	</select>

	<!-- 시험실 품질불만 소요시간 조회 -->
	<select id="Get_TSS270_List_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
	    SELECT  A.DSFT_ACPN_SEQ_NO  
			  , A.ORGN_PTR_ST_CD
			  , A.ORGN_PTR_ST_CDNM
			  , A.PRDCT_CD
	          , (SELECT PRDCT_CDNM
				   FROM TBL_PRDCT_CD
				  WHERE PRDCT_CD = A.PRDCT_CD
	           ) AS PRDCT_CDNM
			  , A.ACPN_DTM
			  , A.VHCL_BIZTR_YN
			  , FLOOR(TO_NUMBER(TO_DATE(SUBSTR(B.TST_REQ_DT,0,8), 'YYYYMMDD')-TO_DATE(SUBSTR(A.ACPN_DTM,0,8), 'YYYYMMDD'))) AS ACPN_REQ
			  , B.TST_REQ_DT
			  , FLOOR(TO_NUMBER(TO_DATE(SUBSTR(C.RECV_DT,0,8), 'YYYYMMDD')-TO_DATE(SUBSTR(B.TST_REQ_DT,0,8), 'YYYYMMDD'))) AS REQ_RECV
			  , C.PRDCT_DTLS_CD
			  , FUN_GET_PRDCT_DTL_CDNM(C.PRDCT_DTLS_CD) AS PRDCT_DTLS_CDNM
			  , C.RECV_DT
			  , FLOOR(TO_NUMBER(TO_DATE(SUBSTR(E.TST_RSLT_SINF_DT,0,8), 'YYYYMMDD')-TO_DATE(SUBSTR(C.RECV_DT,0,8), 'YYYYMMDD'))) AS RECV_RSLT
			  , E.TST_RSLT_SINF_DT
			  , FLOOR(TO_NUMBER(TO_DATE(SUBSTR(F.APRV_DT,0,8), 'YYYYMMDD')-TO_DATE(SUBSTR(E.TST_RSLT_SINF_DT,0,8), 'YYYYMMDD'))) AS RSLT_APRV
			  , F.APRV_DT
			  , FLOOR(TO_NUMBER(TO_DATE(SUBSTR(G.OPNN_REG_DT,0,8), 'YYYYMMDD')-TO_DATE(SUBSTR(F.APRV_DT,0,8), 'YYYYMMDD'))) AS APRV_OPNN
			  , G.OPNN_REG_DT
			  , FLOOR(TO_NUMBER(TO_DATE(SUBSTR(A.PROC_RSLT_INPUT_DTM,0,8), 'YYYYMMDD')-TO_DATE(SUBSTR(G.OPNN_REG_DT,0,8), 'YYYYMMDD'))) AS OPNN_PROC
			  , A.PROC_RSLT_INPUT_DTM
			  , FLOOR(TO_NUMBER(TO_DATE(SUBSTR(G.OPNN_REG_DT,0,8), 'YYYYMMDD')-TO_DATE(SUBSTR(A.ACPN_DTM,0,8), 'YYYYMMDD'))) AS HABB
		  FROM  TBL_DSFT_ACPN_PROC A
		  		LEFT JOIN TBL_TST_REQ B 
		  			  ON A.DSFT_ACPN_SEQ_NO = B.DSFT_ACPN_SEQ_NO
		  		LEFT JOIN TBL_TSTRM_OPNN E 
		  			  ON B.TST_ACPN_SEQ_NO  = E.TST_ACPN_SEQ_NO
		  		LEFT JOIN TBL_TSTRM_APRV F 
		  			  ON E.TST_ACPN_SEQ_NO  = F.TST_ACPN_SEQ_NO
		  		LEFT JOIN TBL_OFCR_OPNN G 
		  			  ON F.TST_ACPN_SEQ_NO  = G.TST_ACPN_SEQ_NO
		  		LEFT JOIN (
		  		          SELECT C.TST_ACPN_SEQ_NO
		  		                ,MAX(C.PRDCT_DTLS_CD) AS PRDCT_DTLS_CD
		  		                ,MAX(D.RECV_DT) AS RECV_DT
		  		          FROM TBL_SAMP_CLCT C 
		  		          INNER JOIN TBL_SAMP_RECV_CNFM D 
		  		          	      ON C.TST_ACPN_SEQ_NO  = D.TST_ACPN_SEQ_NO
		  		          	     AND C.SAMP_NO = D.SAMP_NO
		  		          GROUP BY C.TST_ACPN_SEQ_NO
		  		) C ON F.TST_ACPN_SEQ_NO = C.TST_ACPN_SEQ_NO
		 WHERE A.ACPN_DTM BETWEEN #acpn_dtm_stt#||'000000' AND #acpn_dtm_end#||'240000'
		 AND A.DSFT_TYP_CD IN ('CA','CK')
		 AND B.PRGR_ST_CD = '08'
 	     ORDER BY A.DSFT_ACPN_SEQ_NO ASC
 	</select>
 	
</sqlMap>
