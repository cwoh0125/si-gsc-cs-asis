<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "https://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="CMP180">
 	
 	<!-- 불만유형 콤보	 
  	<select id="Get_CMPType_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
		SELECT  DISTINCT DSFT_TYP_CD    AS  CODE		
		     ,  DSFT_TYP_CDNM  			AS  CODE_NM		
		     ,  PSNL_YN									 개인/법인 	     
		  FROM  TBL_DSFT_TAXN_TYP_CD
         WHERE  USE_YN = 'Y'
	  ORDER BY  DSFT_TYP_CD
 	</select>
 	 -->
 	<!-- 사용여부 체크 불만유형 콤보	  -->
  	<select id="Get_CMPType_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
		SELECT SMLCLAS_CD AS  CODE,           <!--불만 유형-->
   						SMLCLAS_CDNM   AS  CODE_NM         <!--불만 유형명-->           
		 FROM  TBL_UNFYCD_SMLCLAS 
		 WHERE LRGCLAS_CD = 'NW146'
		 AND USE_YN ='Y'
		 ORDER BY SMLCLAS_CD
 	</select>

<!-- 사용 여부 상관 없이 전체 불만 유형 조회 -->
  	<select id="Get_Cmb_Srch_Type_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
		SELECT SMLCLAS_CD AS  CODE,           <!--불만 유형-->
   						SMLCLAS_CDNM   AS  CODE_NM         <!--불만 유형명-->           
		 FROM  TBL_UNFYCD_SMLCLAS 
		 WHERE LRGCLAS_CD = 'NW146'		 
		 ORDER BY SMLCLAS_CD
 	</select>

 	<!--사용 여부 체크없이 불만세부유형 콤보-->
  	<select id="Get_CMPDtlTypeAll_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
		 SELECT A.SMLCLAS_CD AS  HIGH_CODE, 	    <!-- 불만유형코드 -->
					     SUBCLAS_CD1 AS  CODE ,						<!-- 불만세부유형코드 -->
					     SUBCLAS_CDNM1   AS  CODE_NM 		<!-- 불만세부유형코드명 -->		   
					     FROM  TBL_UNFYCD_SUBCLAS A,
	     TBL_UNFYCD_SMLCLAS B
	     WHERE B.LRGCLAS_CD = 'NW146'
	     AND A.SMLCLAS_CD = B.SMLCLAS_CD
	     ORDER BY SUBCLAS_CD1
 	</select>
 		  
 		  <!--사용여부 체크 불만세부유형-->
  	<select id="Get_CMPDtlType_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
		 SELECT A.SMLCLAS_CD AS  HIGH_CODE, 	    <!-- 불만유형코드 -->
					     SUBCLAS_CD1 AS  CODE ,						<!-- 불만세부유형코드 -->
					     SUBCLAS_CDNM1   AS  CODE_NM 		<!-- 불만세부유형코드명 -->		   
					     FROM  TBL_UNFYCD_SUBCLAS A,
	     TBL_UNFYCD_SMLCLAS B
	     WHERE B.LRGCLAS_CD = 'NW146'
	     AND A.SMLCLAS_CD = B.SMLCLAS_CD
	     AND B.USE_YN ='Y' 
	     AND A.USE_YN ='Y'
	     ORDER BY SUBCLAS_CD1
 	</select>

	<!-- 불만조회-->
 	<select id="Get_CMP_List_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
		SELECT A.DSFT_ACPN_SEQ_NO                		  <!-- 불만 접수 일련번호               -->
	         , A.CNSL_SEQ_NO                                  <!-- 상담 일련번호                    -->
	         , A.CUST_ID                                      <!-- 고객 ID                          -->
	         , A.CUST_NM                                      <!-- 고객 명                          -->
		     , A.CUST_ZIP_NO						 <!-- 고객 우편번호                          -->
		     , A.CUST_ADDR						 <!-- 고객 주소                          -->
		     , A.CUST_ADDR_DTLS					 <!-- 고객 주소 상세                          -->
	         , A.CUST_TYPE                                    <!-- 고객 구분 코드                   -->
	         , CASE WHEN A.CUST_TYPE = '1' THEN '개인고객'                                          
	           WHEN A.CUST_TYPE = '2' THEN '일반유/LPG파트너'                                       
	           ELSE '기타제품고객' END AS CUST_TYPENM	        <!-- 고객 구분 코드명                 -->
	         , A.MBPH_NO                                      <!-- 휴대전화 번호                    -->
	         , A.ACPR_ID                                      <!-- 접수자 ID                        -->
	         , FUN_GET_USRNM(A.ACPR_ID) AS ACPR_ID_NM         <!-- 접수자 명	  	                  -->
	         , A.ACPN_DTM                                     <!-- 접수 일시                        -->
	         , A.DSFT_TYP_CD                                  <!-- 불만 유형 코드                   -->    				                  
	         , FUN_GET_TAXN_TYP_CDNM('L',A.DSFT_TYP_CD)	AS DSFT_TYP_CDNM	  <!-- 불만 유형 코드명                 -->
	         , A.DSFT_TAXN_TYP_CD                             <!-- 불만 세부 유형 코드              -->
	         , FUN_GET_TAXN_TYP_CDNM('S',A.DSFT_TAXN_TYP_CD) AS DSFT_TAXN_TYP_CDNM <!-- 불만 세부 유형 코드명            -->			                    
	         , A.REFU_DT                                      <!-- 주유 일자                        -->
	         , A.PRBLM_ORGN_DTM                               <!-- 문제 발생 일시                   -->
	         , A.ORGN_PTR_ST_CD                               <!-- 발생 주유소 코드                 -->
	         , A.ORGN_PTR_ST_CDNM                             <!-- 발생 주유소 명                   -->
	         , A.ORGN_PLCE_DV_CD                              <!-- 발생 장소 구분 코드              -->
			 , FUN_GET_CDNM('OLC32',A.ORGN_PLCE_DV_CD) AS ORGN_PLCE_DV_CDNM <!-- 발생 장소 구분 코드명-->
	         , D.SITE_CD                                      <!-- 사이트 코드              -->
	         , D.CHRG_BUSS_EMP_ID <!-- 담당 영업 사원 ID -->
	         , A.ORGN_ENTR_DV_CD                              <!-- 발생 업체 구분 코드              -->
	         , H.CD_NM AS ORGN_ENTR_DV_CDNM <!-- 발생 업체 구분 코드명  -->
	         , A.ORGN_ENTR_ADDR                               <!-- 발생 업체 주소                   -->
	         , A.ORGN_ENTR_CTFC                               <!-- 발생 업체 연락처                 -->
	         , NVL(A.VOU_PSES_YN,'N') AS VOU_PSES_YN          <!-- 영수증 소지 여부                 -->
	         , A.VOU_PSES_YN_CRDT_CRD                         <!-- 영수증 소지 여부 신용 카드       -->
	         , A.VOU_PSES_YN_BNUS_CRD                         <!-- 영수증 소지 여부 보너스 카드     -->
	         , A.VOU_PSES_YN_CASH_VOU                         <!-- 영수증 소지 여부 현금 영수증     -->
	         , A.SETL_METH_DV_CD                              <!-- 결제 방법 구분 코드              -->
	         , A.PRDCT_CD                                     <!-- 제품 코드                        -->
	         , (SELECT PRDCT_CDNM
	            	 FROM TBL_PRDCT_CD
	             WHERE PRDCT_CD = A.PRDCT_CD
	           ) AS PRDCT_CDNM  <!--  제품 코드명   -->
	         , A.DSFT_CAUS_CD                                 <!-- 불만 원인 코드                   -->
	         , A.PRBLM_PENOM_CD                               <!-- 문제 현상 코드                   -->
	         , FUN_GET_DSFT_TYP_CDNM(A.PRBLM_PENOM_CD) AS PRBLM_PENOM_CDNM  <!--  문제 현상 코드명   -->
	         , A.CAR_KND                                      <!-- 자동차 종                        -->
	         , A.YEAR                                         <!-- 년식                             -->
	         , A.TOT_DR_DSTNC                                 <!-- 총 주행 거리                     -->
	         , NVL(A.GRG_VIST_YN,'N') AS GRG_VIST_YN	                   	  <!-- 정비소 방문 여부                 -->
	         , A.GRG_NM                                       <!-- 정비소 명                        -->
	         , NVL(A.VHCL_REPR_YN,'N') AS VHCL_REPR_YN                        <!-- 차량 수리 여부                   -->
	         , A.VHCL_REPR_KIND_CD                            <!-- 차량 수리 종류 코드              -->
	         , A.VHCL_REPR_DTLS_CTT                           <!-- 차량 수리 상세 내용              -->
	         , NVL(A.PTR_ST_SINF_YN,'N') AS PTR_ST_SINF_YN                     <!-- 주유소 통보 여부                 -->
	         , A.REFU_AMT                                     <!-- 주유 금액                        -->
	         , A.REFU_BEF_TOTZ                                <!-- 주유 전 잔량                     -->
	         , A.REFU_BEF_TOTZ_DTLS                           <!-- 주유 전 잔량 상세                -->
	         , A.DELI_VHCL_NO                                 <!-- 배송 차량 번호                   -->
	         , A.BLNG_OILRSV_CD                               <!-- 소속 저유소 코드                 -->
	         , (SELECT OILRSV_CDNM
	            	 FROM TBL_OILRSV_CD
	             WHERE OILRSV_CD = A.BLNG_OILRSV_CD
	           ) AS BLNG_OILRSV_CDNM  <!-- 소속 저유소 코드명-->
	         , A.BLNG_ENTRNM                                  <!-- 소속 업체명                      -->
	         , A.DRV_NM                                       <!-- 운전기사 명                      -->
	         , A.DRV_MBPH_NO                                  <!-- 운전기사 휴대전화 번호           -->
	         , A.CONN_CHNL_KIND_CD                            <!-- 접속 채널 종류 코드              -->
			 , FUN_GET_CDNM('OLA01',A.CONN_CHNL_KIND_CD) AS CONN_CHNL_KIND_CDNM <!-- 접속 채널 종류 코드명 -->
	         , A.HC_YN                                        <!-- 해피콜 여부                      -->
	         , A.HC_UABL_RSN_CD                               <!-- 해피콜 불가 사유 코드            -->
	         , A.HC_UABL_RSN_ETC_CTT                          <!-- 해피콜 불가 사유 기타 내용       -->
	         , A.CUST_SMLRI1                                  <!-- 고객 소리                        -->
	         , A.DSPSR_ID                                     <!-- 처리자 ID(변경 후)	-->
	         , A.DSPSR_ID  AS OLD_DSPSR_ID                    <!-- 처리자 ID(변경 전)	-->
	         , CASE WHEN F.USR_NM IS NULL OR F.USR_NM = '' THEN G.EMP_NM ELSE F.USR_NM END AS DSPSR_ID_NM <!-- 처리자 명 -->
	         , A.PROC_DTM                                     <!-- 처리 일시                        -->
	         , CASE WHEN A.DSPSR_YN_CNSLR = 'Y' THEN '상담사'
	           WHEN A.DSPSR_YN_DSFT_CHRG = 'Y' THEN '불만담당'
	           WHEN A.DSPSR_YN_PART_HD = 'Y' THEN '파트장'
	           ELSE '' END AS DSPSR_YN	   			          <!-- 처리자 구분                      -->
	         , A.DSPSR_YN_CNSLR                               <!-- 처리자 여부 상담사               -->
	         , A.DSPSR_YN_DSFT_CHRG                           <!-- 처리자 여부 불만 담당            -->
	         , A.DSPSR_YN_PART_HD                             <!-- 처리자 여부 파트 장              -->
	         , A.PROC_RSLT_INPUT_DTM                          <!-- 처리 결과 입력 일시              -->
	         , A.DSPSR_DSTN_DTM                               <!-- 처리자 지정 일시                 -->
	         , A.DSPSR_CHRG_DEPT                              <!-- 처리자 담당 부서                 -->
	         , A.DSPSR_OFLV_CD                                <!-- 처리자 직급 코드                 -->
	         , A.DSPSR_OFLV_CDNM                              <!-- 처리자 직급 코드명 -->
	         , A.DSPSR_TEL_NO                                 <!-- 처리자 전화 번호                 -->
	         , A.DSPSR_MBPH_NO                                <!-- 처리자 휴대전화 번호             -->
	         , A.DSPSR_EML_ADDR                               <!-- 처리자 이메일 주소               -->
	         , A.DSFT_PROC_TYP_CD                             <!-- 불만 처리 유형 코드              -->
	         , A.CHRG_DEPT_CNFM_CAUS_CD                       <!-- 담당 부서 확인 원인 코드         -->
	         , A.PROC_PRGR_STA_CTT                            <!-- 처리 진행 상황 내용              -->
	         , A.PROC_RSLT_CTT                                <!-- 처리 결과 내용                   -->
	         , NVL(A.RWRD_YN,'N') AS RWRD_YN 			      <!-- 보상 여부                        -->
	         , A.PTR_ST_CPS_AMT                               <!-- 주유소 보상금                    -->
	         , A.CO_CPS_AMT                                   <!-- 회사 보상금                      -->
	         , A.TOT_CPS_AMT                                  <!-- 총 보상금                        -->
	         , A.CO_RWRD_CTT                                  <!-- 회사 보상 내용                   -->
	         , NVL(A.VHCL_BIZTR_YN,'N') AS VHCL_BIZTR_YN	  <!-- 차량 출장 여부                   -->
	         , A.VHCL_BIZTR_QLIT_DSFT_TYP_CD                  <!-- 차량 출장 품질 불만 유형 코드    -->
	         , FUN_GET_DSFT_TYP_CDNM(A.VHCL_BIZTR_QLIT_DSFT_TYP_CD) AS VHCL_BIZTR_QLIT_DSFT_TYP_CDNM <!-- 차량 출장 품질 불만 유형 코드명    -->
	         , A.VHCL_QLIT_DSFT_CAUS_CD_CUST                  <!-- 차량 품질 불만 원인 코드 고객    -->
	         , FUN_GET_DSFT_CAUS_CDNM(A.VHCL_QLIT_DSFT_CAUS_CD_CUST) AS VHCL_QLIT_DSFT_CAUS_CD_CUSTNM <!-- 차량 품질 불만 원인 코드명 고객    -->
	         , A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST                <!-- 차량 품질 불만 원인 코드 주유소  -->
	         , FUN_GET_DSFT_CAUS_CDNM(A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST) AS VHCL_QLIT_DSFT_CAUS_CD_PTR_STN <!-- 차량 품질 불만 원인 코드명 주유소    -->


	         <!--, SUBSTR(A.LST_CORC_DTM, 0, 8) AS LST_CORC_DTM	   최종 수정 일시 -->
, CASE WHEN A.PROC_DTM IS NOT NULL THEN '처리완료'
     ELSE CASE WHEN FLOOR(TO_NUMBER(TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'), 'YYYYMMDD')-TO_DATE(SUBSTR(A.LST_CORC_DTM,0,8), 'YYYYMMDD'))) = '0' THEN '오늘'
               ELSE CASE WHEN LENGTH(FLOOR(TO_NUMBER(TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'), 'YYYYMMDD')-TO_DATE(SUBSTR(A.LST_CORC_DTM,0,8), 'YYYYMMDD')))) = 1 
                         THEN '0' || FLOOR(TO_NUMBER(TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'), 'YYYYMMDD')-TO_DATE(SUBSTR(A.LST_CORC_DTM,0,8), 'YYYYMMDD'))) || '일 전'
                         ELSE FLOOR(TO_NUMBER(TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'), 'YYYYMMDD')-TO_DATE(SUBSTR(A.LST_CORC_DTM,0,8), 'YYYYMMDD'))) || '일 전' END
               END
     END AS LST_CORC_DTM


	         , C.EXCT_CNSLR_ID                                <!-- 실시 상담사 ID                   -->
	         , C.EXCT_DTM                                     <!-- 실시 일시                        -->
	         , C.HC_BIZ_DV_CD                                 <!-- 해피콜 업무 구분 코드            -->
	         , C.RSLT_SFT_CD                                  <!-- 결과 만족도 코드                 -->
	         , C.ATTD_SFT_CD                                  <!-- 태도 만족도 코드                 -->
	         , C.HC_CTT                                       <!-- 해피콜 내용                      -->
	         , C.CUR_RSLT_CD                                  <!-- 통화 결과 코드                   -->
	         , C.ETC_OPNN                                     <!-- 기타 의견                        -->
	         , CASE WHEN SUBSTR(A.ACPN_DTM, 0, 8) = TO_CHAR(SYSDATE,'YYYYMMDD') THEN 1 ELSE 0 END AS TODAY_COLOR <!-- 오늘날짜 칼라색상 -->
		  FROM TBL_DSFT_ACPN_PROC A
		        LEFT JOIN TBL_HC_HIST C
		               ON A.DSFT_ACPN_SEQ_NO = C.DSFT_ACPN_SEQ_NO		  <!--해피콜 조인-->
		        LEFT JOIN TBL_CRPN_CUST_BASE D
		       		   ON A.ORGN_PTR_ST_CD = D.CUST_ID        	    	  <!--법인고객기본 조인-->                       
		        LEFT JOIN TBL_USR F <!--유저테이블 조인-->
		       		   ON A.DSPSR_ID = F.USR_ID
		        LEFT JOIN TBL_HR_EMP_CD G <!--인사정보테이블 조인-->
		       		   ON A.DSPSR_ID = G.EMP_NO
		        LEFT JOIN TBL_SAP_CD H	<!-- 직영구분테이블 조인 -->
		       		   ON (A.ORGN_ENTR_DV_CD = H.CD_ID AND H.CD_CLAS_CD = '1')
		 WHERE A.ACPN_DTM BETWEEN #acpn_dtm_from#||'000000' AND #acpn_dtm_to#||'240000'
		   AND (A.DEL_YN = 'N' OR A.DEL_YN IS NULL)
		   AND (A.DSPSR_YN_OB_CNTR = 'N' OR A.DSPSR_YN_OB_CNTR IS NULL)
		<dynamic>
			<isNotEmpty prepend="AND" property="dsft_acpn_seq_no">		<!-- 불만접수번호 검색		-->       
			    A.DSFT_ACPN_SEQ_NO = #dsft_acpn_seq_no#
		  	</isNotEmpty>
			<!--고객구분 체크항목이 하나도 없거나, 모두 체크되어 있는 경우 전체데이터가 조회된다.-->      
	    	<isNotEmpty property="cust_type_chked_yn">                                                    
				<iterate property="iterate_cust_type" open="AND A.CUST_TYPE IN (" close=")" conjunction=",">
					#iterate_cust_type[]#                                                                     
				</iterate>                                                                                  
			</isNotEmpty>
			<!--불만처리여부 체크항목이 하나도 없거나, 모두 체크되어 있는 경우 전체데이터가 조회된다.-->
		 	<isEqual property="cmp_handle_type" compareValue="1">              <!-- 불만처리		-->   
		 		AND	A.PROC_DTM IS NOT NULL                                                                  
		 	</isEqual>
		 	<isEqual property="cmp_handle_type" compareValue="2">              <!-- 불만미처리	-->   
		 		AND	A.PROC_DTM IS NULL                                                                  
		 	</isEqual>
			<!--처리자구분에 체크항목이 하나도 없는 경우, 전체데이터가 조회된다.-->
		 	<isEqual property="cmp_handler" compareValue="1">   
		 		AND	A.DSPSR_YN_CNSLR = 'Y'
		 	</isEqual>
		 	<isEqual property="cmp_handler" compareValue="2">   
		 		AND	(A.DSPSR_YN_CNSLR = 'Y' OR A.DSPSR_YN_DSFT_CHRG = 'Y')
		 	</isEqual>
		 	<isEqual property="cmp_handler" compareValue="3">   
		 		AND	(A.DSPSR_YN_CNSLR = 'Y' OR A.DSPSR_YN_PART_HD = 'Y')
		 	</isEqual>
		 	<isEqual property="cmp_handler" compareValue="4">   
		 		AND	(A.DSPSR_YN_CNSLR = 'Y' OR A.DSPSR_YN_DSFT_CHRG = 'Y' OR A.DSPSR_YN_PART_HD = 'Y')
		 	</isEqual>
		 	<isEqual property="cmp_handler" compareValue="5">   
		 		AND	A.DSPSR_YN_DSFT_CHRG = 'Y'
		 	</isEqual>
		 	<isEqual property="cmp_handler" compareValue="6">   
		 		AND	A.DSPSR_YN_PART_HD = 'Y'
		 	</isEqual>
		 	<isEqual property="cmp_handler" compareValue="7">   
		 		AND	(A.DSPSR_YN_DSFT_CHRG = 'Y' OR A.DSPSR_YN_PART_HD = 'Y')
		 	</isEqual>
			<isNotEmpty prepend="AND" property="cust_nm">			<!-- 고객명 검색		-->                     
			    A.CUST_NM LIKE '%'|| #cust_nm# ||'%'
		  	</isNotEmpty>                                                                                 
			<isNotEmpty prepend="AND" property="cust_id">			<!-- 고객번호 검색		-->                   
			    A.CUST_ID = #cust_id#
		  	</isNotEmpty>
			<isNotEmpty prepend="AND" property="orgn_ptr_st_cd">			<!-- 가맹점SAP코드 검색		-->
			    A.ORGN_PTR_ST_CD = #orgn_ptr_st_cd#
		  	</isNotEmpty>
			<isNotEmpty prepend="AND" property="site_cd">			<!-- 가맹점SITE코드 검색		-->
			    D.SITE_CD = #site_cd#
		  	</isNotEmpty>
			<isNotEmpty prepend="AND" property="dspsr_id">			<!-- 처리자사번 검색		-->               
			    A.DSPSR_ID = #dspsr_id#
		  	</isNotEmpty>                                                                                 
			<isNotEmpty prepend="AND" property="dspsr_id_nm">		<!-- 처리자명 검색	(F.USR_NM = #dspsr_id_nm# OR G.EMP_NM = #dspsr_id_nm#)	-->
	         	(F.USR_NM LIKE '%'|| #dspsr_id_nm# ||'%' OR G.EMP_NM LIKE '%'||#dspsr_id_nm#||'%')
		  	</isNotEmpty>
			<isNotEmpty prepend="AND" property="dsft_typ_cd">		<!-- 불만유형 검색		-->                 
			    A.DSFT_TYP_CD = #dsft_typ_cd#
		  	</isNotEmpty>                                                                                                                                                                 
			<isNotEmpty prepend="AND" property="orgn_ptr_st_cdnm">			<!-- 불만발생업체 검색		-->
			    A.ORGN_PTR_ST_CDNM LIKE '%'|| #orgn_ptr_st_cdnm# ||'%'
		  	</isNotEmpty>                                                                                 
			<isNotEmpty prepend="AND" property="deli_vhcl_no">		<!-- 배송차량번호 검색		-->
			    A.DELI_VHCL_NO LIKE '%'|| #deli_vhcl_no# ||'%'
		  	</isNotEmpty>
		 	<isEqual property="vhcl_biztr_yn" compareValue="Y"> <!-- 차량출장여부 검색 -->
		 		AND A.VHCL_BIZTR_YN = 'Y'
		 	</isEqual>
		 	<isEqual property="vhcl_biztr_yn" compareValue="N"> <!-- 차량출장여부 검색 -->
		 		AND (A.VHCL_BIZTR_YN = 'N' OR A.VHCL_BIZTR_YN IS NULL)
		 	</isEqual>
		 	<isEqual property="hc_yn" compareValue="Y">              <!-- HAPPYCALL 예정, 처리자가 상담사인 경우 해피콜 X -->
		 		AND (A.HC_YN IS NULL AND (A.DSPSR_YN_CNSLR IS NULL OR A.DSPSR_YN_CNSLR = 'N'))
		 	</isEqual>
	 	</dynamic>                                                                                      
		ORDER BY A.ACPN_DTM DESC                                                                        
 	</select>

 <!-- 불만이력 삭제  -->
	<update id="Set_CMP_DELETE" parameterClass="java.util.HashMap">
		 UPDATE TBL_DSFT_ACPN_PROC 
		    SET DEL_YN = 'Y'
		      , DELT_ID = #gbl_usr_id#
		      , DEL_DTM = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
		      , LST_CORC_ID = #gbl_usr_id#
		      , LST_CORC_DTM = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
		  WHERE DSFT_ACPN_SEQ_NO = #dsft_acpn_seq_no#
	</update>
	
	<!-- 불만상담이력 조회-->
 	<select id="Get_RECORD_List_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
    	SELECT A.DSFT_ACPN_SEQ_NO                              <!-- 불만 접수 일련번호 -->
	         , B.CNSL_SEQ_NO AS DSFT_CNSL_SEQ_NO               <!-- 상담 일련번호      -->
	         , B.PH_REC_SEQ_NO                                 <!-- 녹취 일련번호      -->
	         , B.CNSL_DTM                                      <!-- 상담 일시          -->
	         , B.CNSLR_ID                                      <!-- 상담사 ID          -->
	         , B.CUST_NM                                       <!-- 고객 명            -->
	         , B.CUR_TEL_NO AS TEL_NO                          <!-- 전화 번호          -->
	         , B.EXT_NO                          			   <!-- 내선 번호          -->
	      FROM TBL_DSFT_ACPN_PROC A
	           INNER JOIN TBL_CNSL_HIST B
	           		   ON A.CNSL_SEQ_NO = B.CNSL_SEQ_NO
		 WHERE DSFT_ACPN_SEQ_NO = #dsft_acpn_seq_no#
		<dynamic>		 
			<isNotEmpty prepend="AND" property="tel_no">	   <!-- 전화 번호 검색		-->
			    B.CUR_TEL_NO LIKE '%'|| #tel_no# ||'%'
		  </isNotEmpty>
	 	</dynamic>
	     UNION ALL
		SELECT A.DSFT_ACPN_SEQ_NO                                <!-- 불만 접수 일련번호 -->
	         , A.DSFT_CNSL_SEQ_NO                                <!-- 상담 일련번호      -->
	         , A.PH_REC_SEQ_NO                                   <!-- 녹취 일련번호      -->
	         , A.CNSL_DTM                                        <!-- 상담 일시          -->
	         , A.CNSLR_ID                                        <!-- 상담사 ID          -->
	         , A.CUST_NM                                         <!-- 고객 명            -->
	         , A.TEL_NO                                          <!-- 전화 번호          -->
	         , B.CNSLR_EXT_NO AS EXT_NO                          <!-- 내선 번호          -->
		  FROM TBL_DSFT_CNSL_HIST A
	           INNER JOIN TBL_PH_REC_INFO B
	           		   ON A.PH_REC_SEQ_NO = B.PH_REC_SEQ_NO
		 WHERE DSFT_ACPN_SEQ_NO = #dsft_acpn_seq_no#
		<dynamic>		 
			<isNotEmpty prepend="AND" property="tel_no">	   <!-- 전화 번호 검색		-->
			    TEL_NO LIKE '%'|| #tel_no# ||'%'
		  </isNotEmpty>
	 	</dynamic>
		ORDER BY CNSL_DTM
 	</select> 	
 
	<!-- 불만상담이력 삽입	  -->
	<insert id="Set_RECORD_INSERT" parameterClass="java.util.HashMap">
		INSERT INTO TBL_DSFT_CNSL_HIST(
			 DSFT_ACPN_SEQ_NO		  	<!-- 불만 접수 일련번호    -->
			,DSFT_CNSL_SEQ_NO			<!-- 상담 일련번호         -->
			,PH_REC_SEQ_NO   			<!-- 녹취 일련번호         -->
			,CNSL_DTM        		  	<!-- 상담 일시             -->
			,CNSLR_ID        			<!-- 상담사 ID             -->
			,CUST_NM         			<!-- 고객 명               -->
			,TEL_NO          			<!-- 전화 번호             -->
			,REG_ID          			<!-- 등록 ID               -->
			,REG_DTM         		  	<!-- 등록 일시             -->
			,LST_CORC_ID     			<!-- 최종 수정 ID          -->
			,LST_CORC_DTM    			<!-- 최종 수정 일시        -->
		) VALUES (
			 #dsft_acpn_seq_no#
			,FUN_GET_SEQ('CMP180', #gbl_usr_id#)
			,#ph_rec_seq_no#
			,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
			,#cnslr_id#
			,#cust_nm#
			,#tel_no#
			,#gbl_usr_id#
			,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
			,#gbl_usr_id#
			,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
		)
	</insert>

	<!-- 녹취테이블 삽입	  -->
	<insert id="Set_PH_REC_INSERT" parameterClass="java.util.HashMap">
		INSERT INTO TBL_PH_REC_INFO(
			 PH_REC_SEQ_NO   			<!-- 녹취 일련번호 -->
			,CNSLR_ID        			<!-- 상담사 ID -->
			,CNSLR_NM        			<!-- 상담사 명 -->
			,CNSLR_EXT_NO        	<!-- 상담사 내선 번호 -->
			,PH_REC_STR_DTM       <!-- 상담일시 -->
		) VALUES (
			 #ph_rec_seq_no#
			,#cnslr_id#
			,#cnslr_nm#
			,#ext_no#
			,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
		)
	</insert>

 <!-- 불만처리 수정  -->
	<update id="Set_CMP_UPDATE" parameterClass="java.util.HashMap">
		 UPDATE TBL_DSFT_ACPN_PROC
		    SET 
		        CUST_ID                       = #cust_id#                            <!-- 고객 ID          -->
		      , CUST_NM                       = #cust_nm#                            <!-- 고객 명                          -->
		      , CUST_ZIP_NO					  =	#cust_zip_no#					 	 <!-- 고객 우편번호                          -->
		      , CUST_ADDR					  = #cust_addr#							 <!-- 고객 주소                          -->
		      , CUST_ADDR_DTLS				  = #cust_addr_dtls#					 <!-- 고객 주소 상세                          -->
		      , CUST_TYPE                     = #cust_type#                          <!-- 고객 구분 코드                   -->
		      , MBPH_NO                       = #mbph_no#                            <!-- 휴대전화 번호                    -->
		      , DSFT_TYP_CD                   = #dsft_typ_cd#                        <!-- 불만 유형 코드                   -->
		      , DSFT_TAXN_TYP_CD              = #dsft_taxn_typ_cd#                   <!-- 불만 세부 유형 코드              -->
		      , REFU_DT                       = #refu_dt#                            <!-- 주유 일자                        -->
		      , PRBLM_ORGN_DTM                = #prblm_orgn_dtm#                     <!-- 문제 발생 일시                   -->
		      , ORGN_PTR_ST_CD                = #orgn_ptr_st_cd#                     <!-- 발생 주유소 코드                 -->
		      , ORGN_PTR_ST_CDNM              = #orgn_ptr_st_cdnm#                   <!-- 발생 주유소 명                 -->
		      , ORGN_PLCE_DV_CD               = #orgn_plce_dv_cd#                    <!-- 발생 장소 구분 코드              -->
		      , ORGN_ENTR_DV_CD               = #orgn_entr_dv_cd#                    <!-- 발생 업체 구분 코드              -->
		      , ORGN_ENTR_ADDR                = #orgn_entr_addr#                     <!-- 발생 업체 주소                   -->
		      , ORGN_ENTR_CTFC                = #orgn_entr_ctfc#                     <!-- 발생 업체 연락처                 -->
		      , VOU_PSES_YN                   = #vou_pses_yn#                        <!-- 영수증 소지 여부                 -->
		      , VOU_PSES_YN_CRDT_CRD          = #vou_pses_yn_crdt_crd#               <!-- 영수증 소지 여부 신용 카드       -->
		      , VOU_PSES_YN_BNUS_CRD          = #vou_pses_yn_bnus_crd#               <!-- 영수증 소지 여부 보너스 카드     -->
		      , VOU_PSES_YN_CASH_VOU          = #vou_pses_yn_cash_vou#               <!-- 영수증 소지 여부 현금 영수증     -->
		      , SETL_METH_DV_CD               = #setl_meth_dv_cd#                    <!-- 결제 방법 구분 코드              -->
		      , PRDCT_CD                      = #prdct_cd#                           <!-- 제품 코드                        -->
		      , DSFT_CAUS_CD                  = #dsft_caus_cd#                       <!-- 불만 원인 코드                   -->
		      , PRBLM_PENOM_CD                = #prblm_penom_cd#                     <!-- 문제 현상 코드                   -->
		      , CAR_KND                       = #car_knd#                            <!-- 자동차 종                        -->
		      , YEAR                          = #year#                               <!-- 년식                             -->
		      , TOT_DR_DSTNC                  = #tot_dr_dstnc#                       <!-- 총 주행 거리                     -->
		      , GRG_VIST_YN                   = #grg_vist_yn#                        <!-- 정비소 방문 여부                 -->
		      , GRG_NM                        = #grg_nm#                             <!-- 정비소 명                        -->
		      , VHCL_REPR_YN                  = #vhcl_repr_yn#                       <!-- 차량 수리 여부                   -->
		      , VHCL_REPR_KIND_CD             = #vhcl_repr_kind_cd#                  <!-- 차량 수리 종류 코드              -->
		      , VHCL_REPR_DTLS_CTT            = #vhcl_repr_dtls_ctt#                 <!-- 차량 수리 상세 내용              -->
		      , PTR_ST_SINF_YN                = #ptr_st_sinf_yn#                     <!-- 주유소 통보 여부                 -->
		      , REFU_AMT                      = #refu_amt#                           <!-- 주유 금액                        -->
		      , REFU_BEF_TOTZ                 = #refu_bef_totz#                      <!-- 주유 전 잔량                     -->
		      , REFU_BEF_TOTZ_DTLS            = #refu_bef_totz_dtls#                 <!-- 주유 전 잔량 상세                -->
		      , DELI_VHCL_NO                  = #deli_vhcl_no#                       <!-- 배송 차량 번호                   -->
		      , BLNG_OILRSV_CD                = #blng_oilrsv_cd#                     <!-- 소속 저유소 코드                 -->
		      , BLNG_ENTRNM                   = #blng_entrnm#                        <!-- 소속 업체명                      -->
		      , DRV_NM                        = #drv_nm#                             <!-- 운전기사 명                      -->
		      , DRV_MBPH_NO                   = #drv_mbph_no#                        <!-- 운전기사 휴대전화 번호           -->
		      , CONN_CHNL_KIND_CD             = #conn_chnl_kind_cd#                  <!-- 접속 채널 종류 코드              -->
		      , HC_YN                         = #hc_yn#                              <!-- 해피콜 실시 여부                 -->
			  , HC_UABL_RSN_CD				  = #hc_uabl_rsn_cd#				     <!-- 해피콜 불가 사유 코드            -->
			  , HC_UABL_RSN_ETC_CTT			  = #hc_uabl_rsn_etc_ctt#			     <!-- 해피콜 불가 사유 기타 내용       -->
		       , CUST_SMLRI                    = #cust_smlri#                         <!-- 고객 소리                        -->
		      , CUST_SMLRI1                    =  #cust_smlri1#                         <!-- 고객 소리          -->
          	  , DSPSR_ID                      = CASE WHEN #chk_handle_change# = 'Y' THEN #dspsr_id#
          	                                         ELSE DSPSR_ID END               <!-- 처리자 ID         -->
          	  , PROC_DTM                      = #proc_dtm#                           <!-- 처리 일시                        -->
    	 	  , DSPSR_YN_CNSLR				  = #dspsr_yn_cnslr#					 <!-- 처리자 여부 상담사               -->
    	 	  , DSPSR_YN_DSFT_CHRG			  = #dspsr_yn_dsft_chrg#				 <!-- 처리자 여부 불만 담당            -->
    		  , DSPSR_YN_PART_HD			  = #dspsr_yn_part_hd#					 <!-- 처리자 여부 파트 장              -->
          	  , PROC_RSLT_INPUT_DTM			  										 <!-- 처리 결과 입력 일시              -->           
          	    = CASE WHEN #proc_rslt_input_dtm# = 'true' THEN TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
          	      	   ELSE PROC_RSLT_INPUT_DTM END
          	  , DSPSR_DSTN_DTM                = CASE WHEN #chk_handle_change# = 'Y' THEN TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
          	                                         ELSE DSPSR_DSTN_DTM END               <!-- 처리자 지정 일시  -->
          	  , DSPSR_CHRG_DEPT               = CASE WHEN #chk_handle_change# = 'Y' THEN #dspsr_chrg_dept#
          	                                         ELSE DSPSR_CHRG_DEPT END               <!-- 처리자 담당 부서 -->
			  , DSPSR_CHRG_DEPT_CD   =  #dspsr_chrg_dept_cd#  <!-- 처리 담당자 부서 코드 -->           	                                         
          	  , DSPSR_OFLV_CD                 = CASE WHEN #chk_handle_change# = 'Y' THEN #dspsr_oflv_cd#
          	                                         ELSE DSPSR_OFLV_CD END               <!-- 처리자 직급 코드 -->
          	  , DSPSR_OFLV_CDNM               = CASE WHEN #chk_handle_change# = 'Y' THEN #dspsr_oflv_cdnm#
          	                                         ELSE DSPSR_OFLV_CDNM END             <!-- 처리자 직급 코드명 -->
          	  , DSPSR_TEL_NO                  = CASE WHEN #chk_handle_change# = 'Y' THEN #dspsr_tel_no#
          	                                         ELSE DSPSR_TEL_NO END               <!-- 처리자 전화 번호  -->
          	  , DSPSR_MBPH_NO                 = CASE WHEN #chk_handle_change# = 'Y' THEN #dspsr_mbph_no#
          	                                         ELSE DSPSR_MBPH_NO END               <!-- 처리자 휴대전화 번호 -->
          	  , DSPSR_EML_ADDR                = CASE WHEN #chk_handle_change# = 'Y' THEN #dspsr_eml_addr#
          	                                         ELSE DSPSR_EML_ADDR END               <!-- 처리자 이메일 주소  -->
          	  , DSFT_PROC_TYP_CD              = #dsft_proc_typ_cd#                   <!-- 불만 처리 유형 코드              -->
          	  , CHRG_DEPT_CNFM_CAUS_CD        = #chrg_dept_cnfm_caus_cd#             <!-- 담당 부서 확인 원인 코드         -->
          	  , PROC_PRGR_STA_CTT             = #proc_prgr_sta_ctt#                  <!-- 처리 진행 상황 내용              -->
          	  , PROC_RSLT_CTT                 = #proc_rslt_ctt#                      <!-- 처리 결과 내용                   -->
          	  , RWRD_YN                       = #rwrd_yn#                            <!-- 보상 여부                        -->
          	  , PTR_ST_CPS_AMT                = #ptr_st_cps_amt#                     <!-- 주유소 보상금                    -->
          	  , CO_CPS_AMT                    = #co_cps_amt#                         <!-- 회사 보상금                      -->
          	  , TOT_CPS_AMT                   = #tot_cps_amt#                        <!-- 총 보상금                        -->
          	  , CO_RWRD_CTT                   = #co_rwrd_ctt#                        <!-- 회사 보상 내용                   -->
          	  , VHCL_BIZTR_YN                 = #vhcl_biztr_yn#                      <!-- 차량 출장 여부                   -->
          	  , VHCL_BIZTR_QLIT_DSFT_TYP_CD   = #vhcl_biztr_qlit_dsft_typ_cd#        <!-- 차량 출장 품질 불만 유형 코드    -->
          	  , VHCL_QLIT_DSFT_CAUS_CD_CUST   = #vhcl_qlit_dsft_caus_cd_cust#        <!-- 차량 품질 불만 원인 코드 고객    -->
          	  , VHCL_QLIT_DSFT_CAUS_CD_PTR_ST = #vhcl_qlit_dsft_caus_cd_ptr_st#      <!-- 차량 품질 불만 원인 코드 주유소  -->
	          , LST_CORC_ID                   = #gbl_usr_id#                         <!-- 최종 수정 ID                     -->
		      , LST_CORC_DTM                  = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')  <!-- 최종 수정 일시                   -->
		      , SM_CMP_YN                     = #sm_cmp_yn#
		      , SM_CMP_RMK                    = #sm_cmp_rmk#
		      , SM_CMP_MAIL_YN                = #sm_cmp_mail_yn#
		      , SAMP_YN							=	#samp_yn#
		  WHERE DSFT_ACPN_SEQ_NO = #dsft_acpn_seq_no#
	</update>
	
 <!-- 해피콜 등록 : 기존에 있으면 UPDATE, 없으면 INSERT  -->
	<update id="Set_HC_UPDATE" parameterClass="java.util.HashMap">
	    MERGE INTO TBL_HC_HIST A
	    USING (SELECT #dsft_acpn_seq_no# AS DSFT_ACPN_SEQ_NO
	    		 FROM DUAL) B
           ON (A.DSFT_ACPN_SEQ_NO = B.DSFT_ACPN_SEQ_NO)
         WHEN MATCHED THEN
	 	      UPDATE SET
		             EXCT_CNSLR_ID = #gbl_usr_id#                         <!-- 실시 상담사 ID       -->
		           , EXCT_DTM      = #exct_dtm#                           <!-- 실시 일시            -->
		           , RSLT_SFT_CD   = #rslt_sft_cd#                        <!-- 결과 만족도 코드     -->
		           , ATTD_SFT_CD   = #attd_sft_cd#                        <!-- 태도 만족도 코드     -->
		           , HC_CTT        = #hc_ctt#                             <!-- 해피콜 내용          -->
		           , LST_CORC_ID   = #gbl_usr_id#						  <!-- 최종 수정 ID         -->
		           , LST_CORC_DTM  = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')  <!-- 최종 수정 일시       -->
         WHEN NOT MATCHED THEN
       		  INSERT (
            	     DSFT_ACPN_SEQ_NO    <!-- 일련번호       -->
            	   , EXCT_CNSLR_ID    <!-- 실시 상담사 ID       -->
             	   , EXCT_DTM         <!-- 실시 일시            -->
             	   , RSLT_SFT_CD      <!-- 결과 만족도 코드     -->
             	   , ATTD_SFT_CD      <!-- 태도 만족도 코드     -->
             	   , HC_CTT           <!-- 해피콜 내용          -->
             	   , REG_ID           <!-- 등록 ID              -->
             	   , REG_DTM          <!-- 등록 일시            -->
             	   , LST_CORC_ID      <!-- 최종 수정 ID         -->
             	   , LST_CORC_DTM     <!-- 최종 수정 일시       -->
        	  )VALUES(
             	     #dsft_acpn_seq_no#
             	   , #gbl_usr_id#
             	   , #exct_dtm#
             	   , #rslt_sft_cd#
             	   , #attd_sft_cd#
             	   , #hc_ctt#
             	   , #gbl_usr_id#
             	   , TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
             	   , #gbl_usr_id#
             	   , TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
          	  )
	</update>


	<!-- 불만조회-->
 	<select id="Get_CMP_List2_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
		SELECT A.DSFT_ACPN_SEQ_NO                		  <!-- 불만 접수 일련번호               -->
	         , A.CNSL_SEQ_NO                                  <!-- 상담 일련번호                    -->
	         , A.CUST_ID                                      <!-- 고객 ID                          -->
	         , A.CUST_NM                                      <!-- 고객 명                          -->
		     , A.CUST_ZIP_NO						 <!-- 고객 우편번호                          -->
		     , A.CUST_ADDR						 <!-- 고객 주소                          -->
		     , A.CUST_ADDR_DTLS					 <!-- 고객 주소 상세                          -->
	         , A.CUST_TYPE                                    <!-- 고객 구분 코드                   -->
	         , CASE WHEN A.CUST_TYPE = '1' THEN '개인고객'                                          
	           WHEN A.CUST_TYPE = '2' THEN '일반유/LPG파트너'                                       
	           ELSE '기타제품고객' END AS CUST_TYPENM	        <!-- 고객 구분 코드명                 -->
	         , A.MBPH_NO                                      <!-- 휴대전화 번호                    -->
	         , A.ACPR_ID                                      <!-- 접수자 ID                        -->
	         , FUN_GET_USRNM(A.ACPR_ID) AS ACPR_ID_NM         <!-- 접수자 명	  	                  -->
	         , A.ACPN_DTM                                     <!-- 접수 일시                        -->
	         , A.DSFT_TYP_CD                                  <!-- 불만 유형 코드                   -->
	         , FUN_GET_TAXN_TYP_CDNM('L',A.DSFT_TYP_CD)    AS DSFT_TYP_CDNM      <!-- 불만 유형 코드명                 -->
             , A.DSFT_TAXN_TYP_CD                             <!-- 불만 세부 유형 코드              -->
             , FUN_GET_TAXN_TYP_CDNM('S',A.DSFT_TAXN_TYP_CD) AS DSFT_TAXN_TYP_CDNM <!-- 불만 세부 유형 코드명            -->                             
             , A.REFU_DT                                      <!-- 주유 일자                        -->
	         , A.PRBLM_ORGN_DTM                               <!-- 문제 발생 일시                   -->
	         , A.ORGN_PTR_ST_CD                               <!-- 발생 주유소 코드                 -->
	         , A.ORGN_PTR_ST_CDNM                             <!-- 발생 주유소 명                   -->
	         , A.ORGN_PLCE_DV_CD                              <!-- 발생 장소 구분 코드              -->
			 , FUN_GET_CDNM('OLC32',A.ORGN_PLCE_DV_CD) AS ORGN_PLCE_DV_CDNM <!-- 발생 장소 구분 코드명-->
	         , D.SITE_CD                                      <!-- 사이트 코드              -->
	         , D.CHRG_BUSS_EMP_ID <!-- 담당 영업 사원 ID -->
	         , A.ORGN_ENTR_DV_CD                              <!-- 발생 업체 구분 코드              -->
	         , H.CD_NM AS ORGN_ENTR_DV_CDNM <!-- 발생 업체 구분 코드명  -->
	         , A.ORGN_ENTR_ADDR                               <!-- 발생 업체 주소                   -->
	         , A.ORGN_ENTR_CTFC                               <!-- 발생 업체 연락처                 -->
	         , NVL(A.VOU_PSES_YN,'N') AS VOU_PSES_YN          <!-- 영수증 소지 여부                 -->
	         , A.VOU_PSES_YN_CRDT_CRD                         <!-- 영수증 소지 여부 신용 카드       -->
	         , A.VOU_PSES_YN_BNUS_CRD                         <!-- 영수증 소지 여부 보너스 카드     -->
	         , A.VOU_PSES_YN_CASH_VOU                         <!-- 영수증 소지 여부 현금 영수증     -->
	         , A.SETL_METH_DV_CD                              <!-- 결제 방법 구분 코드              -->
	         , A.PRDCT_CD                                     <!-- 제품 코드                        -->
	         , (SELECT PRDCT_CDNM
	            	 FROM TBL_PRDCT_CD
	             WHERE PRDCT_CD = A.PRDCT_CD
	           ) AS PRDCT_CDNM  <!--  제품 코드명   -->
	         , A.DSFT_CAUS_CD                                 <!-- 불만 원인 코드                   -->
	         , A.PRBLM_PENOM_CD                               <!-- 문제 현상 코드                   -->
	         , FUN_GET_DSFT_TYP_CDNM(A.PRBLM_PENOM_CD) AS PRBLM_PENOM_CDNM  <!--  문제 현상 코드명   -->
	         , A.CAR_KND                                      <!-- 자동차 종                        -->
	         , A.YEAR                                         <!-- 년식                             -->
	         , A.TOT_DR_DSTNC                                 <!-- 총 주행 거리                     -->
	         , NVL(A.GRG_VIST_YN,'N') AS GRG_VIST_YN	                   	  <!-- 정비소 방문 여부                 -->
	         , A.GRG_NM                                       <!-- 정비소 명                        -->
	         , NVL(A.VHCL_REPR_YN,'N') AS VHCL_REPR_YN                        <!-- 차량 수리 여부                   -->
	         , A.VHCL_REPR_KIND_CD                            <!-- 차량 수리 종류 코드              -->
	         , A.VHCL_REPR_DTLS_CTT                           <!-- 차량 수리 상세 내용              -->
	         , NVL(A.PTR_ST_SINF_YN,'N') AS PTR_ST_SINF_YN                     <!-- 주유소 통보 여부                 -->
	         , A.REFU_AMT                                     <!-- 주유 금액                        -->
	         , A.REFU_BEF_TOTZ                                <!-- 주유 전 잔량                     -->
	         , A.REFU_BEF_TOTZ_DTLS                           <!-- 주유 전 잔량 상세                -->
	         , A.DELI_VHCL_NO                                 <!-- 배송 차량 번호                   -->
	         , A.BLNG_OILRSV_CD                               <!-- 소속 저유소 코드                 -->
	         , (SELECT OILRSV_CDNM
	            	 FROM TBL_OILRSV_CD
	             WHERE OILRSV_CD = A.BLNG_OILRSV_CD
	           ) AS BLNG_OILRSV_CDNM  <!-- 소속 저유소 코드명-->
	         , A.BLNG_ENTRNM                                  <!-- 소속 업체명                      -->
	         , A.DRV_NM                                       <!-- 운전기사 명                      -->
	         , A.DRV_MBPH_NO                                  <!-- 운전기사 휴대전화 번호           -->
	         , A.CONN_CHNL_KIND_CD                            <!-- 접속 채널 종류 코드              -->
			 , FUN_GET_CDNM('OLA01',A.CONN_CHNL_KIND_CD) AS CONN_CHNL_KIND_CDNM <!-- 접속 채널 종류 코드명 -->
	         , A.HC_YN                                        <!-- 해피콜 여부                      -->
	         , A.HC_UABL_RSN_CD                               <!-- 해피콜 불가 사유 코드            -->
	         , A.HC_UABL_RSN_ETC_CTT                          <!-- 해피콜 불가 사유 기타 내용       -->
	         , A.CUST_SMLRI                                   <!-- 고객 소리                        -->
	         , A.DSPSR_ID                                     <!-- 처리자 ID(변경 후)	-->
	         , A.DSPSR_ID  AS OLD_DSPSR_ID                    <!-- 처리자 ID(변경 전)	-->
	         , CASE WHEN F.USR_NM IS NULL OR F.USR_NM = '' THEN G.EMP_NM ELSE F.USR_NM END AS DSPSR_ID_NM <!-- 처리자 명 -->
	         , A.PROC_DTM                                     <!-- 처리 일시                        -->
	         , CASE WHEN A.DSPSR_YN_CNSLR = 'Y' THEN '상담사'
	           WHEN A.DSPSR_YN_DSFT_CHRG = 'Y' THEN '불만담당'
	           WHEN A.DSPSR_YN_PART_HD = 'Y' THEN '파트장'
	           ELSE '' END AS DSPSR_YN	   			          <!-- 처리자 구분                      -->
	         , A.DSPSR_YN_CNSLR                               <!-- 처리자 여부 상담사               -->
	         , A.DSPSR_YN_DSFT_CHRG                           <!-- 처리자 여부 불만 담당            -->
	         , A.DSPSR_YN_PART_HD                             <!-- 처리자 여부 파트 장              -->
	         , A.PROC_RSLT_INPUT_DTM                          <!-- 처리 결과 입력 일시              -->
	         , A.DSPSR_DSTN_DTM                               <!-- 처리자 지정 일시                 -->
	         , A.DSPSR_CHRG_DEPT                              <!-- 처리자 담당 부서                 -->
	         , A.DSPSR_CHRG_DEPT_CD                              <!-- 처리자 담당 부서 코드                 -->
	         , A.DSPSR_OFLV_CD                                <!-- 처리자 직급 코드                 -->
	         , A.DSPSR_OFLV_CDNM                              <!-- 처리자 직급 코드명 -->
	         , A.DSPSR_TEL_NO                                 <!-- 처리자 전화 번호                 -->
	         , A.DSPSR_MBPH_NO                                <!-- 처리자 휴대전화 번호             -->
	         , A.DSPSR_EML_ADDR                               <!-- 처리자 이메일 주소               -->
	         , A.DSFT_PROC_TYP_CD                             <!-- 불만 처리 유형 코드              -->
	         , A.CHRG_DEPT_CNFM_CAUS_CD                       <!-- 담당 부서 확인 원인 코드         -->
	         , A.PROC_PRGR_STA_CTT                            <!-- 처리 진행 상황 내용              -->
	         , A.PROC_RSLT_CTT                                <!-- 처리 결과 내용                   -->
	         , NVL(A.RWRD_YN,'N') AS RWRD_YN 			      <!-- 보상 여부                        -->
	         , A.PTR_ST_CPS_AMT                               <!-- 주유소 보상금                    -->
	         , A.CO_CPS_AMT                                   <!-- 회사 보상금                      -->
	         , A.TOT_CPS_AMT                                  <!-- 총 보상금                        -->
	         , A.CO_RWRD_CTT                                  <!-- 회사 보상 내용                   -->
	         , NVL(A.VHCL_BIZTR_YN,'N') AS VHCL_BIZTR_YN	  <!-- 차량 출장 여부                   -->
	         , A.VHCL_BIZTR_QLIT_DSFT_TYP_CD                  <!-- 차량 출장 품질 불만 유형 코드    -->
	         , FUN_GET_DSFT_TYP_CDNM(A.VHCL_BIZTR_QLIT_DSFT_TYP_CD) AS VHCL_BIZTR_QLIT_DSFT_TYP_CDNM <!-- 차량 출장 품질 불만 유형 코드명    -->
	         , A.VHCL_QLIT_DSFT_CAUS_CD_CUST                  <!-- 차량 품질 불만 원인 코드 고객    -->
	         , FUN_GET_DSFT_CAUS_CDNM(A.VHCL_QLIT_DSFT_CAUS_CD_CUST) AS VHCL_QLIT_DSFT_CAUS_CD_CUSTNM <!-- 차량 품질 불만 원인 코드명 고객    -->
	         , A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST                <!-- 차량 품질 불만 원인 코드 주유소  -->
	         , FUN_GET_DSFT_CAUS_CDNM(A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST) AS VHCL_QLIT_DSFT_CAUS_CD_PTR_STN <!-- 차량 품질 불만 원인 코드명 주유소    -->
	         , SUBSTR(A.LST_CORC_DTM, 0, 8) AS LST_CORC_DTM	  <!-- 최종 수정 일시 -->
	         , C.EXCT_CNSLR_ID                                <!-- 실시 상담사 ID                   -->
	         , C.EXCT_DTM                                     <!-- 실시 일시                        -->
	         , C.HC_BIZ_DV_CD                                 <!-- 해피콜 업무 구분 코드            -->
	         , C.RSLT_SFT_CD                                  <!-- 결과 만족도 코드                 -->
	         , C.ATTD_SFT_CD                                  <!-- 태도 만족도 코드                 -->
	         , C.HC_CTT                                       <!-- 해피콜 내용                      -->
	         , C.CUR_RSLT_CD                                  <!-- 통화 결과 코드                   -->
	         , C.ETC_OPNN                                     <!-- 기타 의견                        -->
	         , CASE WHEN SUBSTR(A.ACPN_DTM, 0, 8) = TO_CHAR(SYSDATE,'YYYYMMDD') THEN 1 ELSE 0 END AS TODAY_COLOR <!-- 오늘날짜 칼라색상 -->
		  FROM TBL_DSFT_ACPN_PROC A
		        LEFT JOIN TBL_HC_HIST C
		               ON A.DSFT_ACPN_SEQ_NO = C.DSFT_ACPN_SEQ_NO		  <!--해피콜 조인-->
		        LEFT JOIN TBL_CRPN_CUST_BASE D
		       		   ON A.ORGN_PTR_ST_CD = D.CUST_ID        	    	  <!--법인고객기본 조인-->
		        LEFT JOIN TBL_USR F <!--유저테이블 조인-->
		       		   ON A.DSPSR_ID = F.USR_ID
		        LEFT JOIN TBL_HR_EMP_CD G <!--인사정보테이블 조인-->
		       		   ON A.DSPSR_ID = G.EMP_NO
		        LEFT JOIN TBL_SAP_CD H	<!-- 직영구분테이블 조인 -->
		       		   ON (A.ORGN_ENTR_DV_CD = H.CD_ID AND H.CD_CLAS_CD = '1')
		 WHERE A.DSFT_ACPN_SEQ_NO = #dsft_acpn_seq_no#
		   AND (A.DEL_YN = 'N' OR A.DEL_YN IS NULL)
		ORDER BY A.ACPN_DTM DESC
 	</select>

		<update id="Set_OB_UPDATE" parameterClass="java.util.HashMap">
		
		update TBL_DSFT_ACPN_PROC set 
		DSPSR_CHRG_DEPT='',
		DSPSR_OFLV_CD='',
		DSPSR_OFLV_CDNM='',
		DSPSR_YN_PART_HD='',
		DSPSR_ID='',
		DSPSR_YN_OB_CNTR='Y',
		OB_CNTR_DV_CD=#ob_cntr_dv_cd#,
		DSFT_TYP_CD=#dsft_typ_cd#,
		OB_CODE1=#ob_code1#,
		OB_CODE2=#ob_code2#,
		OB_CODE3=#ob_code3#
		
		where DSFT_ACPN_SEQ_NO=#dsft_acpn_seq_no# 
		
		</update>
		
			<delete id="Set_OB_DELETE" parameterClass="java.util.HashMap">
		
		delete TBL_DSFT_ACPN_DSPSR_HIST 
		
		where DSFT_ACPN_SEQ_NO=#dsft_acpn_seq_no# and DSPSR_DSTN_DTM=#dspsr_dstn_dtm#
		
		</delete>

	<select id="Get_CMP_List_SELECT_temp" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
		SELECT A.DSFT_ACPN_SEQ_NO                		  <!-- 불만 접수 일련번호               -->
	         , A.CNSL_SEQ_NO                                  <!-- 상담 일련번호                    -->
	         , A.CUST_ID                                      <!-- 고객 ID                          -->
	         , A.CUST_NM                                      <!-- 고객 명                          -->
		     , A.CUST_ZIP_NO						 <!-- 고객 우편번호                          -->
		     , A.CUST_ADDR						 <!-- 고객 주소                          -->
		     , A.CUST_ADDR_DTLS					 <!-- 고객 주소 상세                          -->
	         , A.CUST_TYPE                                    <!-- 고객 구분 코드                   -->
	         , CASE WHEN A.CUST_TYPE = '1' THEN '개인고객'                                          
	           WHEN A.CUST_TYPE = '2' THEN '일반유/LPG파트너'                                       
	           ELSE '기타제품고객' END AS CUST_TYPENM	        <!-- 고객 구분 코드명                 -->
	         , A.MBPH_NO                                      <!-- 휴대전화 번호                    -->
	         , A.ACPR_ID                                      <!-- 접수자 ID                        -->
	         , FUN_GET_USRNM(A.ACPR_ID) AS ACPR_ID_NM         <!-- 접수자 명	  	                  -->
	         , A.ACPN_DTM                                     <!-- 접수 일시                        -->
	         , A.DSFT_TYP_CD                                  <!-- 불만 유형 코드                   -->    				                  
	         , FUN_GET_TAXN_TYP_CDNM('L',A.DSFT_TYP_CD)	AS DSFT_TYP_CDNM	  <!-- 불만 유형 코드명                 -->
	         , A.DSFT_TAXN_TYP_CD                             <!-- 불만 세부 유형 코드              -->
	         , FUN_GET_TAXN_TYP_CDNM('S',A.DSFT_TAXN_TYP_CD) AS DSFT_TAXN_TYP_CDNM <!-- 불만 세부 유형 코드명            -->			                    
	         , A.REFU_DT                                      <!-- 주유 일자                        -->
	         , A.PRBLM_ORGN_DTM                               <!-- 문제 발생 일시                   -->
	         , A.ORGN_PTR_ST_CD                               <!-- 발생 주유소 코드                 -->
	         , A.ORGN_PTR_ST_CDNM                             <!-- 발생 주유소 명                   -->
	         , A.ORGN_PLCE_DV_CD                              <!-- 발생 장소 구분 코드              -->
			 , FUN_GET_CDNM('OLC32',A.ORGN_PLCE_DV_CD) AS ORGN_PLCE_DV_CDNM <!-- 발생 장소 구분 코드명-->
	         , D.SITE_CD                                      <!-- 사이트 코드              -->
	         , D.CHRG_BUSS_EMP_ID <!-- 담당 영업 사원 ID -->
	         , A.ORGN_ENTR_DV_CD                              <!-- 발생 업체 구분 코드              -->
	         , H.CD_NM AS ORGN_ENTR_DV_CDNM <!-- 발생 업체 구분 코드명  -->
	         , A.ORGN_ENTR_ADDR                               <!-- 발생 업체 주소                   -->
	         , A.ORGN_ENTR_CTFC                               <!-- 발생 업체 연락처                 -->
	         , NVL(A.VOU_PSES_YN,'N') AS VOU_PSES_YN          <!-- 영수증 소지 여부                 -->
	         , A.VOU_PSES_YN_CRDT_CRD                         <!-- 영수증 소지 여부 신용 카드       -->
	         , A.VOU_PSES_YN_BNUS_CRD                         <!-- 영수증 소지 여부 보너스 카드     -->
	         , A.VOU_PSES_YN_CASH_VOU                         <!-- 영수증 소지 여부 현금 영수증     -->
	         , A.SETL_METH_DV_CD                              <!-- 결제 방법 구분 코드              -->
	         , A.PRDCT_CD                                     <!-- 제품 코드                        -->
	         , (SELECT PRDCT_CDNM
	            	 FROM TBL_PRDCT_CD
	             WHERE PRDCT_CD = A.PRDCT_CD
	           ) AS PRDCT_CDNM  <!--  제품 코드명   -->
	         , A.DSFT_CAUS_CD                                 <!-- 불만 원인 코드                   -->
	         , A.PRBLM_PENOM_CD                               <!-- 문제 현상 코드                   -->
	         , FUN_GET_DSFT_TYP_CDNM(A.PRBLM_PENOM_CD) AS PRBLM_PENOM_CDNM  <!--  문제 현상 코드명   -->
	         , A.CAR_KND                                      <!-- 자동차 종                        -->
	         , A.YEAR                                         <!-- 년식                             -->
	         , A.TOT_DR_DSTNC                                 <!-- 총 주행 거리                     -->
	         , NVL(A.GRG_VIST_YN,'N') AS GRG_VIST_YN	                   	  <!-- 정비소 방문 여부                 -->
	         , A.GRG_NM                                       <!-- 정비소 명                        -->
	         , NVL(A.VHCL_REPR_YN,'N') AS VHCL_REPR_YN                        <!-- 차량 수리 여부                   -->
	         , A.VHCL_REPR_KIND_CD                            <!-- 차량 수리 종류 코드              -->
	         , A.VHCL_REPR_DTLS_CTT                           <!-- 차량 수리 상세 내용              -->
	         , NVL(A.PTR_ST_SINF_YN,'N') AS PTR_ST_SINF_YN                     <!-- 주유소 통보 여부                 -->
	         , A.REFU_AMT                                     <!-- 주유 금액                        -->
	         , A.REFU_BEF_TOTZ                                <!-- 주유 전 잔량                     -->
	         , A.REFU_BEF_TOTZ_DTLS                           <!-- 주유 전 잔량 상세                -->
	         , A.DELI_VHCL_NO                                 <!-- 배송 차량 번호                   -->
	         , A.BLNG_OILRSV_CD                               <!-- 소속 저유소 코드                 -->
	         , (SELECT OILRSV_CDNM
	            	 FROM TBL_OILRSV_CD
	             WHERE OILRSV_CD = A.BLNG_OILRSV_CD
	           ) AS BLNG_OILRSV_CDNM  <!-- 소속 저유소 코드명-->
	         , A.BLNG_ENTRNM                                  <!-- 소속 업체명                      -->
	         , A.DRV_NM                                       <!-- 운전기사 명                      -->
	         , A.DRV_MBPH_NO                                  <!-- 운전기사 휴대전화 번호           -->
	         , A.CONN_CHNL_KIND_CD                            <!-- 접속 채널 종류 코드              -->
			 , FUN_GET_CDNM('OLA01',A.CONN_CHNL_KIND_CD) AS CONN_CHNL_KIND_CDNM <!-- 접속 채널 종류 코드명 -->
	         , A.HC_YN                                        <!-- 해피콜 여부                      -->
	         , A.HC_UABL_RSN_CD                               <!-- 해피콜 불가 사유 코드            -->
	         , A.HC_UABL_RSN_ETC_CTT                          <!-- 해피콜 불가 사유 기타 내용       -->
	         , A.CUST_SMLRI                       <!-- 고객 소리-->
	         , A.CUST_SMLRI1                       <!-- 고객 소리-->
	         , A.DSPSR_ID                                     <!-- 처리자 ID(변경 후)	-->
	         , A.DSPSR_ID  AS OLD_DSPSR_ID                    <!-- 처리자 ID(변경 전)	-->
	         , CASE WHEN F.USR_NM IS NULL OR F.USR_NM = '' THEN G.EMP_NM ELSE F.USR_NM END AS DSPSR_ID_NM <!-- 처리자 명 -->
	         , A.PROC_DTM                                     <!-- 처리 일시                        -->
	         , CASE WHEN A.DSPSR_YN_CNSLR = 'Y' THEN '상담사'
	           WHEN A.DSPSR_YN_DSFT_CHRG = 'Y' THEN '불만담당'
	           WHEN A.DSPSR_YN_PART_HD = 'Y' THEN '파트장'
	           ELSE '' END AS DSPSR_YN	   			          <!-- 처리자 구분                      -->
	         , A.DSPSR_YN_CNSLR                               <!-- 처리자 여부 상담사               -->
	         , A.DSPSR_YN_DSFT_CHRG                           <!-- 처리자 여부 불만 담당            -->
	         , A.DSPSR_YN_PART_HD                             <!-- 처리자 여부 파트 장              -->
	         , A.PROC_RSLT_INPUT_DTM                          <!-- 처리 결과 입력 일시              -->
	         , A.DSPSR_DSTN_DTM                               <!-- 처리자 지정 일시                 -->
	         , A.DSPSR_CHRG_DEPT                              <!-- 처리자 담당 부서                 -->	       
             , A.DSPSR_CHRG_DEPT_CD                              <!-- 처리자 담당 부서 코드                -->
	         , A.DSPSR_OFLV_CD                                <!-- 처리자 직급 코드                 -->
	         , A.DSPSR_OFLV_CDNM                              <!-- 처리자 직급 코드명 -->
	         , A.DSPSR_TEL_NO                                 <!-- 처리자 전화 번호                 -->
	         , A.DSPSR_MBPH_NO                                <!-- 처리자 휴대전화 번호             -->
	         , A.DSPSR_EML_ADDR                               <!-- 처리자 이메일 주소               -->
	         , A.DSFT_PROC_TYP_CD                             <!-- 불만 처리 유형 코드              -->
	         , A.CHRG_DEPT_CNFM_CAUS_CD                       <!-- 담당 부서 확인 원인 코드         -->
	         , A.PROC_PRGR_STA_CTT                            <!-- 처리 진행 상황 내용              -->
	         , A.PROC_RSLT_CTT                                <!-- 처리 결과 내용                   -->
	         , NVL(A.RWRD_YN,'N') AS RWRD_YN 			      <!-- 보상 여부                        -->
	         , A.PTR_ST_CPS_AMT                               <!-- 주유소 보상금                    -->
	         , A.CO_CPS_AMT                                   <!-- 회사 보상금                      -->
	         , A.TOT_CPS_AMT                                  <!-- 총 보상금                        -->
	         , A.CO_RWRD_CTT                                  <!-- 회사 보상 내용                   -->
	         , NVL(A.VHCL_BIZTR_YN,'N') AS VHCL_BIZTR_YN	  <!-- 차량 출장 여부                   -->
	         , A.VHCL_BIZTR_QLIT_DSFT_TYP_CD                  <!-- 차량 출장 품질 불만 유형 코드    -->
	         , FUN_GET_DSFT_TYP_CDNM(A.VHCL_BIZTR_QLIT_DSFT_TYP_CD) AS VHCL_BIZTR_QLIT_DSFT_TYP_CDNM <!-- 차량 출장 품질 불만 유형 코드명    -->
	         , A.VHCL_QLIT_DSFT_CAUS_CD_CUST                  <!-- 차량 품질 불만 원인 코드 고객    -->
	         , FUN_GET_DSFT_CAUS_CDNM(A.VHCL_QLIT_DSFT_CAUS_CD_CUST) AS VHCL_QLIT_DSFT_CAUS_CD_CUSTNM <!-- 차량 품질 불만 원인 코드명 고객    -->
	         , A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST                <!-- 차량 품질 불만 원인 코드 주유소  -->
	         , FUN_GET_DSFT_CAUS_CDNM(A.VHCL_QLIT_DSFT_CAUS_CD_PTR_ST) AS VHCL_QLIT_DSFT_CAUS_CD_PTR_STN <!-- 차량 품질 불만 원인 코드명 주유소    -->


	         <!--, SUBSTR(A.LST_CORC_DTM, 0, 8) AS LST_CORC_DTM	   최종 수정 일시 -->
, CASE WHEN A.PROC_DTM IS NOT NULL THEN '처리완료'
     ELSE CASE WHEN FLOOR(TO_NUMBER(TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'), 'YYYYMMDD')-TO_DATE(SUBSTR(A.LST_CORC_DTM,0,8), 'YYYYMMDD'))) = '0' THEN '오늘'
               ELSE CASE WHEN LENGTH(FLOOR(TO_NUMBER(TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'), 'YYYYMMDD')-TO_DATE(SUBSTR(A.LST_CORC_DTM,0,8), 'YYYYMMDD')))) = 1 
                         THEN '0' || FLOOR(TO_NUMBER(TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'), 'YYYYMMDD')-TO_DATE(SUBSTR(A.LST_CORC_DTM,0,8), 'YYYYMMDD'))) || '일 전'
                         ELSE FLOOR(TO_NUMBER(TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'), 'YYYYMMDD')-TO_DATE(SUBSTR(A.LST_CORC_DTM,0,8), 'YYYYMMDD'))) || '일 전' END
               END
     END AS LST_CORC_DTM


	         , C.EXCT_CNSLR_ID                                <!-- 실시 상담사 ID                   -->
	         , C.EXCT_DTM                                     <!-- 실시 일시                        -->
	         , C.HC_BIZ_DV_CD                                 <!-- 해피콜 업무 구분 코드            -->
	         , C.RSLT_SFT_CD                                  <!-- 결과 만족도 코드                 -->
	         , C.ATTD_SFT_CD                                  <!-- 태도 만족도 코드                 -->
	         , C.HC_CTT                                       <!-- 해피콜 내용                      -->
	         , C.CUR_RSLT_CD                                  <!-- 통화 결과 코드                   -->
	         , C.ETC_OPNN                                     <!-- 기타 의견                        -->
	         , CASE WHEN SUBSTR(A.ACPN_DTM, 0, 8) = TO_CHAR(SYSDATE,'YYYYMMDD') THEN 1 ELSE 0 END AS TODAY_COLOR <!-- 오늘날짜 칼라색상 -->
	         , A.SM_CMP_YN
	         , A.SM_CMP_RMK
	         , A.SM_CMP_MAIL_YN
	         , A.SAMP_YN
             
		  FROM TBL_DSFT_ACPN_PROC A
		        LEFT JOIN TBL_HC_HIST C
		               ON A.DSFT_ACPN_SEQ_NO = C.DSFT_ACPN_SEQ_NO		  <!--해피콜 조인-->
		        LEFT JOIN TBL_CRPN_CUST_BASE D
		       		   ON A.ORGN_PTR_ST_CD = D.CUST_ID        	    	  <!--법인고객기본 조인-->                       
		        LEFT JOIN TBL_USR F <!--유저테이블 조인-->
		       		   ON A.DSPSR_ID = F.USR_ID
		         LEFT JOIN TBL_HR_EMP_CD G   <!--인사정보 테이블 조인-->
		       		   ON A.DSPSR_ID = G.EMP_NO		       		    
		       		    AND
		       		   A.DSPSR_CHRG_DEPT = G.BLNG_DEPT_CDNM		       		   
		        LEFT JOIN TBL_SAP_CD H	<!-- 직영구분테이블 조인 -->
		       		   ON (A.ORGN_ENTR_DV_CD = H.CD_ID AND H.CD_CLAS_CD = '1')
		 WHERE A.ACPN_DTM BETWEEN #acpn_dtm_from#||'000000' AND #acpn_dtm_to#||'240000'
		   AND (A.DEL_YN = 'N' OR A.DEL_YN IS NULL)
		   AND (A.DSPSR_YN_OB_CNTR = 'N' OR A.DSPSR_YN_OB_CNTR IS NULL)<!-- 기타 건은 제외 -->
		<dynamic>
			<isNotEmpty prepend="AND" property="dsft_acpn_seq_no">		<!-- 불만접수번호 검색		-->       
			    A.DSFT_ACPN_SEQ_NO = #dsft_acpn_seq_no#
		  	</isNotEmpty>
			<!--고객구분 체크항목이 하나도 없거나, 모두 체크되어 있는 경우 전체데이터가 조회된다.-->      
	    	<isNotEmpty property="cust_type_chked_yn">                                                    
				<iterate property="iterate_cust_type" open="AND A.CUST_TYPE IN (" close=")" conjunction=",">
					#iterate_cust_type[]#                                                                     
				</iterate>                                                                                  
			</isNotEmpty>
			<!--불만처리여부 체크항목이 하나도 없거나, 모두 체크되어 있는 경우 전체데이터가 조회된다.-->
		 	<isEqual property="cmp_handle_type" compareValue="1">              <!-- 불만처리		-->   
		 		AND	A.PROC_DTM IS NOT NULL                                                                  
		 	</isEqual>
		 	<isEqual property="cmp_handle_type" compareValue="2">              <!-- 불만미처리	-->   
		 		AND	A.PROC_DTM IS NULL                                                                  
		 	</isEqual>
			<!--처리자구분에 체크항목이 하나도 없는 경우, 전체데이터가 조회된다.-->
		 	<isEqual property="cmp_handler" compareValue="1">   
		 		AND	A.DSPSR_YN_CNSLR = 'Y'
		 	</isEqual>
		 	<isEqual property="cmp_handler" compareValue="2">   
		 		AND	(A.DSPSR_YN_CNSLR = 'Y' OR A.DSPSR_YN_DSFT_CHRG = 'Y')
		 	</isEqual>
		 	<isEqual property="cmp_handler" compareValue="3">   
		 		AND	(A.DSPSR_YN_CNSLR = 'Y' OR A.DSPSR_YN_PART_HD = 'Y')
		 	</isEqual>
		 	<isEqual property="cmp_handler" compareValue="4">   
		 		AND	(A.DSPSR_YN_CNSLR = 'Y' OR A.DSPSR_YN_DSFT_CHRG = 'Y' OR A.DSPSR_YN_PART_HD = 'Y')
		 	</isEqual>
		 	<isEqual property="cmp_handler" compareValue="5">   
		 		AND	A.DSPSR_YN_DSFT_CHRG = 'Y'
		 	</isEqual>
		 	<isEqual property="cmp_handler" compareValue="6">   
		 		AND	A.DSPSR_YN_PART_HD = 'Y'
		 	</isEqual>
		 	<isEqual property="cmp_handler" compareValue="7">   
		 		AND	(A.DSPSR_YN_DSFT_CHRG = 'Y' OR A.DSPSR_YN_PART_HD = 'Y')
		 	</isEqual>
			<isNotEmpty prepend="AND" property="cust_nm">			<!-- 고객명 검색		-->                     
			    A.CUST_NM LIKE '%'|| #cust_nm# ||'%'
		  	</isNotEmpty>                                                                                 
			<isNotEmpty prepend="AND" property="cust_id">			<!-- 고객번호 검색		-->                   
			    A.CUST_ID = #cust_id#
		  	</isNotEmpty>
			<isNotEmpty prepend="AND" property="orgn_ptr_st_cd">			<!-- 가맹점SAP코드 검색		-->
			    A.ORGN_PTR_ST_CD = #orgn_ptr_st_cd#
		  	</isNotEmpty>
			<isNotEmpty prepend="AND" property="site_cd">			<!-- 가맹점SITE코드 검색		-->
			    D.SITE_CD = #site_cd#
		  	</isNotEmpty>
			<isNotEmpty prepend="AND" property="dspsr_id">			<!-- 처리자사번 검색		-->               
			    A.DSPSR_ID = #dspsr_id#
		  	</isNotEmpty>                                                                                 
			<isNotEmpty prepend="AND" property="dspsr_id_nm">		<!-- 처리자명 검색	(F.USR_NM = #dspsr_id_nm# OR G.EMP_NM = #dspsr_id_nm#)	-->
	         	(F.USR_NM LIKE '%'|| #dspsr_id_nm# ||'%' OR G.EMP_NM LIKE '%'||#dspsr_id_nm#||'%')
		  	</isNotEmpty>
			<isNotEmpty prepend="AND" property="dsft_typ_cd">		<!-- 불만유형 검색		-->                 
			    A.DSFT_TYP_CD = #dsft_typ_cd#
		  	</isNotEmpty>                                                                                                                                                                 
			<isNotEmpty prepend="AND" property="orgn_ptr_st_cdnm">			<!-- 불만발생업체 검색		-->
			    A.ORGN_PTR_ST_CDNM LIKE '%'|| #orgn_ptr_st_cdnm# ||'%'
		  	</isNotEmpty>                                                                                 
			<isNotEmpty prepend="AND" property="deli_vhcl_no">		<!-- 배송차량번호 검색		-->
			    A.DELI_VHCL_NO LIKE '%'|| #deli_vhcl_no# ||'%'
		  	</isNotEmpty>
		 	<isEqual property="vhcl_biztr_yn" compareValue="Y"> <!-- 차량출장여부 검색 -->
		 		AND A.VHCL_BIZTR_YN = 'Y'
		 	</isEqual>
		 	<isEqual property="vhcl_biztr_yn" compareValue="N"> <!-- 차량출장여부 검색 -->
		 		AND (A.VHCL_BIZTR_YN = 'N' OR A.VHCL_BIZTR_YN IS NULL)
		 	</isEqual>
		 	<isEqual property="hc_yn" compareValue="Y">              <!-- HAPPYCALL 예정, 처리자가 상담사인 경우 해피콜 X -->
		 		AND (A.HC_YN IS NULL AND (A.DSPSR_YN_CNSLR IS NULL OR A.DSPSR_YN_CNSLR = 'N'))
		 	</isEqual>
	 	</dynamic>                                                                                      
		ORDER BY A.ACPN_DTM DESC                                                                        
 	</select>

<select id="Get_DEPT_List_SELECT" resultClass="java.util.HashMap"  parameterClass="java.util.HashMap">
	SELECT HGRK_DEPT_CDNM , HGRK_DEPT_CD, DEPT_CDNM ,DEPT_CD
 		FROM TBL_HR_DEPT_CD                       
		 WHERE 1=1
  <!-- and HGRK_DEPT_CD NOT IN ('E00054','E00056','T21000','E00053','E00042','E00044','JD1000','E00048') -->
 		GROUP BY HGRK_DEPT_CDNM , HGRK_DEPT_CD, DEPT_CDNM ,DEPT_CD
 		ORDER BY      HGRK_DEPT_CDNM  
</select>

	<!-- TM 불만처리 결과 update --> 
	<update id="Set_TM_DSFT_ACPN_PROC_UPDATE"  parameterClass="java.util.HashMap">
		UPDATE TBL_DSFT_ACPN_PROC SET
			 PROC_RSLT_CTT 						= #PROC_RSLT_CTT#
			,PROC_RSLT_INPUT_DTM		= #PROC_RSLT_INPUT_DTM#
			,OB_CODE1									=	#OB_CODE1#
			,OB_CODE2									=	#OB_CODE2#
			,PROC_DTM								= #PROC_DTM#
			,DSPSR_ID									= #DSPSR_ID#
			,LST_CORC_DTM						= TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
		WHERE DSFT_ACPN_SEQ_NO = #DSFT_ACPN_SEQ_NO#
	</update>
	

 </sqlMap>
